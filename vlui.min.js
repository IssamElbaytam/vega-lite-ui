!function(){(function(){function e(t,n){function i(e){if(i[e]!==v)return i[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=i("json-stringify")&&i("json-parse");else{var a,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var s=n.stringify,d="function"==typeof s&&b;if(d){(a=function(){return 1}).toJSON=a;try{d="0"===s(0)&&"0"===s(new l)&&'""'==s(new r)&&s(y)===v&&s(v)===v&&s()===v&&"1"===s(a)&&"[1]"==s([a])&&"[null]"==s([v])&&"null"==s(null)&&"[null,null,null]"==s([v,y,null])&&s({a:[a,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===s(null,a)&&"[\n 1,\n 2\n]"==s([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==s(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==s(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==s(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==s(new c(-1))}catch(u){d=!1}}t=d}if("json-parse"==e){var f=n.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){a=f(o);var p=5==a.a.length&&1===a.a[0];if(p){try{p=!f('"	"')}catch(u){}if(p)try{p=1!==f("01")}catch(u){}if(p)try{p=1!==f("1.")}catch(u){}}}}catch(u){p=!1}t=p}}return i[e]=!!t}t||(t=o.Object()),n||(n=o.Object());var l=t.Number||o.Number,r=t.String||o.String,s=t.Object||o.Object,c=t.Date||o.Date,d=t.SyntaxError||o.SyntaxError,u=t.TypeError||o.TypeError,f=t.Math||o.Math,p=t.JSON||o.JSON;"object"==typeof p&&p&&(n.stringify=p.stringify,n.parse=p.parse);var g,m,v,h=s.prototype,y=h.toString,b=new c(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(O){}var A="[object Function]",D="[object Date]",S="[object Number]",T="[object String]",w="[object Array]",E="[object Boolean]",N=i("bug-string-char-index");if(!b)var C=f.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],R=function(e,t){return k[t]+365*(e-1970)+C((e-1969+(t=+(t>1)))/4)-C((e-1901+t)/100)+C((e-1601+t)/400)};(g=h.hasOwnProperty)||(g=function(e){var t,a={};return(a.__proto__=null,a.__proto__={toString:1},a).toString!=y?g=function(e){var t=this.__proto__,a=e in(this.__proto__=null,this);return this.__proto__=t,a}:(t=a.constructor,g=function(e){var a=(this.constructor||t).prototype;return e in this&&!(e in a&&this[e]===a[e])}),a=null,g.call(this,e)}),m=function(e,t){var n,o,i,l=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,o=new n;for(i in o)g.call(o,i)&&l++;return n=o=null,l?m=2==l?function(e,t){var a,n={},o=y.call(e)==A;for(a in e)o&&"prototype"==a||g.call(n,a)||!(n[a]=1)||!g.call(e,a)||t(a)}:function(e,t){var a,n,o=y.call(e)==A;for(a in e)o&&"prototype"==a||!g.call(e,a)||(n="constructor"===a)||t(a);(n||g.call(e,a="constructor"))&&t(a)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var n,i,l=y.call(e)==A,r=!l&&"function"!=typeof e.constructor&&a[typeof e.hasOwnProperty]&&e.hasOwnProperty||g;for(n in e)l&&"prototype"==n||!r.call(e,n)||t(n);for(i=o.length;n=o[--i];r.call(e,n)&&t(n));}),m(e,t)};var L={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},_="000000",I=function(e,t){return(_+(t||0)).slice(-e)},x="\\u00",U=function(e){for(var t='"',a=0,n=e.length,o=!N||n>10,i=o&&(N?e.split(""):e);n>a;a++){var l=e.charCodeAt(a);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=L[l];break;default:if(32>l){t+=x+I(2,l.toString(16));break}t+=o?i[a]:e.charAt(a)}}return t+'"'},M=function(e,t,a,n,o,i,l,r){var s,c,d,f,p,h,b,O,A,N,k,L,_,x,F,B;r=r||0;try{s=t[e]}catch(G){}if("object"==typeof s&&s)if(c=y.call(s),c!=D||g.call(s,"toJSON"))"function"==typeof s.toJSON&&(c!=S&&c!=T&&c!=w||g.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(R){for(p=C(s/864e5),d=C(p/365.2425)+1970-1;R(d+1,0)<=p;d++);for(f=C((p-R(d,0))/30.42);R(d,f+1)<=p;f++);p=1+p-R(d,f),h=(s%864e5+864e5)%864e5,b=C(h/36e5)%24,O=C(h/6e4)%60,A=C(h/1e3)%60,N=h%1e3}else d=s.getUTCFullYear(),f=s.getUTCMonth(),p=s.getUTCDate(),b=s.getUTCHours(),O=s.getUTCMinutes(),A=s.getUTCSeconds(),N=s.getUTCMilliseconds();s=(0>=d||d>=1e4?(0>d?"-":"+")+I(6,0>d?-d:d):I(4,d))+"-"+I(2,f+1)+"-"+I(2,p)+"T"+I(2,b)+":"+I(2,O)+":"+I(2,A)+"."+I(3,N)+"Z"}else s=null;if(a&&(s=a.call(t,e,s)),null===s)return"null";if(c=y.call(s),c==E)return""+s;if(c==S)return s>-1/0&&1/0>s?""+s:"null";if(c==T)return U(""+s);if("object"==typeof s){for(x=l.length;x--;)if(l[x]===s)throw u();if(l.push(s),k=[],F=i,i+=o,c==w){var B,H=i.length;for(_=0,x=s.length;x>_;_++)L=M(_,s,a,n,o,i,l,r),B=L===v?"null":L,H+=B.length+(_>0?1:0),k.push(B);B=k.length?o&&H>r?"[\n"+i+k.join(",\n"+i)+"\n"+F+"]":"["+k.join(",")+"]":"[]"}else{var H=i.length,_=0;m(n||s,function(e){var t,c=M(e,s,a,n,o,i,l,r);c!==v&&(t=U(e)+":"+(o?" ":"")+c,H+=t.length+(_++>0?1:0),k.push(t))}),B=k.length?o&&H>r?"{\n"+i+k.join(",\n"+i)+"\n"+F+"}":"{"+k.join(",")+"}":"{}"}return l.pop(),B}};if(n.stringify=function(e,t,n,o){var i,l,r,s;if(a[typeof t]&&t)if((s=y.call(t))==A)l=t;else if(s==w){r={};for(var c,d=0,u=t.length;u>d;c=t[d++],s=y.call(c),(s==T||s==S)&&(r[c]=1));}if(n)if((s=y.call(n))==S){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else s==T&&(i=n.length<=10?n:n.slice(0,10));return M("",(c={},c[""]=e,c),l,r,i,"",[],o)},n.compactStringify=function(e,t,a){return n.stringify(e,t,a,60)},!i("json-parse")){var F,B,G=r.fromCharCode,H={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw F=B=null,d()},j=function(){for(var e,t,a,n,o,i=B,l=i.length;l>F;)switch(o=i.charCodeAt(F)){case 9:case 10:case 13:case 32:F++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=N?i.charAt(F):i[F],F++,e;case 34:for(e="@",F++;l>F;)if(o=i.charCodeAt(F),32>o)P();else if(92==o)switch(o=i.charCodeAt(++F)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=H[o],F++;break;case 117:for(t=++F,a=F+4;a>F;F++)o=i.charCodeAt(F),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||P();e+=G("0x"+i.slice(t,F));break;default:P()}else{if(34==o)break;for(o=i.charCodeAt(F),t=F;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++F);e+=i.slice(t,F)}if(34==i.charCodeAt(F))return F++,e;P();default:if(t=F,45==o&&(n=!0,o=i.charCodeAt(++F)),o>=48&&57>=o){for(48==o&&(o=i.charCodeAt(F+1),o>=48&&57>=o)&&P(),n=!1;l>F&&(o=i.charCodeAt(F),o>=48&&57>=o);F++);if(46==i.charCodeAt(F)){for(a=++F;l>a&&(o=i.charCodeAt(a),o>=48&&57>=o);a++);a==F&&P(),F=a}if(o=i.charCodeAt(F),101==o||69==o){for(o=i.charCodeAt(++F),(43==o||45==o)&&F++,a=F;l>a&&(o=i.charCodeAt(a),o>=48&&57>=o);a++);a==F&&P(),F=a}return+i.slice(t,F)}if(n&&P(),"true"==i.slice(F,F+4))return F+=4,!0;if("false"==i.slice(F,F+5))return F+=5,!1;if("null"==i.slice(F,F+4))return F+=4,null;P()}return"$"},K=function(e){var t,a;if("$"==e&&P(),"string"==typeof e){if("@"==(N?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=j(),"]"!=e;a||(a=!0))a&&(","==e?(e=j(),"]"==e&&P()):P()),","==e&&P(),t.push(K(e));return t}if("{"==e){for(t={};e=j(),"}"!=e;a||(a=!0))a&&(","==e?(e=j(),"}"==e&&P()):P()),(","==e||"string"!=typeof e||"@"!=(N?e.charAt(0):e[0])||":"!=j())&&P(),t[e.slice(1)]=K(j());return t}P()}return e},$=function(e,t,a){var n=z(e,t,a);n===v?delete e[t]:e[t]=n},z=function(e,t,a){var n,o=e[t];if("object"==typeof o&&o)if(y.call(o)==w)for(n=o.length;n--;)$(o,n,a);else m(o,function(e){$(o,e,a)});return a.call(e,t,o)};n.parse=function(e,t){var a,n;return F=0,B=""+e,a=K(j()),"$"!=j()&&P(),F=B=null,t&&y.call(t)==A?z((n={},n[""]=a,n),"",t):a}}return n.runInContext=e,n}var t="function"==typeof define&&define.amd,a={"function":!0,object:!0},n=a[typeof exports]&&exports&&!exports.nodeType&&exports,o=a[typeof window]&&window||this,i=n&&a[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!i||i.global!==i&&i.window!==i&&i.self!==i||(o=i),n&&!t)e(o,n);else{var l=o.JSON,r=o.JSON3,s=!1,c=e(o,o.JSON3={noConflict:function(){return s||(s=!0,o.JSON=l,o.JSON3=r,l=r=null),c}});o.JSON={parse:c.parse,stringify:c.stringify}}t&&define(function(){return c})}).call(this)}(),function(){"use strict";angular.module("vlui",["LocalStorageModule","angular-google-analytics"]).constant("_",window._).constant("dl",window.dl).constant("vl",window.vl).constant("vg",window.vg).constant("Blob",window.Blob).constant("URL",window.URL).constant("Drop",window.Drop).constant("Heap",window.Heap).constant("JSON3",window.JSON3.noConflict()).constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!0,defaultConfigSet:"large",appId:"vlui",embeddedData:window.vguiData||void 0,priority:{bookmark:0,popup:0,vislist:1e3},myriaRest:"http://ec2-52-1-38-182.compute-1.amazonaws.com:8753",defaultTimeFn:"year",typeNames:{nominal:"text",ordinal:"text-ordinal",quantitative:"number",temporal:"time",geographic:"geo"}})}(),function(){angular.module("vlui").run(["$templateCache",function(e){e.put("alertmessages/alertmessages.html",'<div class="alert-box" ng-show="Alerts.alerts.length > 0"><div class="alert-item" ng-repeat="alert in Alerts.alerts">{{ alert.msg }} <a class="close" ng-click="Alerts.closeAlert($index)">&times;</a></div></div>'),e.put("bookmarklist/bookmarklist.html",'<modal id="bookmark-list" ng-if="Bookmarks.isSupported"><div class="modal-header card no-top-margin no-right-margin"><modal-close-button on-close="logBookmarksClosed()"></modal-close-button><h2 class="no-bottom-margin">Bookmarks ({{ Bookmarks.length }})</h2><a ng-click="Bookmarks.clear()"><i class="fa fa-trash-o"></i> Clear all</a></div><div class="flex-grow-1 scroll-y"><div ng-if="Bookmarks.length > 0" class="hflex flex-wrap"><vl-plot-group ng-repeat="chart in Bookmarks.dict | orderObjectBy : \'timeAdded\' : false" class="wrapped-vl-plot-group card" chart="chart" field-set="chart.fieldSet" show-bookmark="true" show-debug="consts.debug" show-expand="false" always-selected="true" highlighted="highlighted" overflow="true" tooltip="true" priority="consts.priority.bookmark"></vl-plot-group></div><div class="vis-list-empty" ng-if="Bookmarks.length === 0">You have no bookmarks</div></div></modal>'),e.put("dataset/addmyriadataset.html",'<div class="add-myria-dataset"><p>Select a dataset from the Myria instance at <input ng-model="myriaRestUrl"><button ng-click="loadDatasets(\'\')">update</button>.</p><form ng-submit="addDataset(myriaDataset)"><div><select name="myria-dataset" id="select-myria-dataset" ng-disabled="disabled" ng-model="myriaDataset" ng-options="optionName(dataset) for dataset in myriaDatasets track by dataset.relationName"><option value="">Select Dataset...</option></select></div><button type="submit">Add dataset</button></form></div>'),e.put("dataset/addurldataset.html",'<div class="add-url-dataset"><p>Add the name of the dataset and the URL to a <b>JSON</b> or <b>CSV</b> (with header) file. Make sure that the formatting is correct and clean the data before adding it. The added dataset is only visible to you.</p><form ng-submit="addFromUrl(addedDataset)"><div class="form-group"><label for="dataset-name">Name</label> <input ng-model="addedDataset.name" id="dataset-name" type="text"></div><div class="form-group"><label for="dataset-url">URL</label> <input ng-model="addedDataset.url" id="dataset-url" type="url"><p>Make sure that you host the file on a server that has <code>Access-Control-Allow-Origin: *</code> set.</p></div><button type="submit">Add dataset</button></form></div>'),e.put("dataset/changeloadeddataset.html",'<div class="change-loaded-dataset"><div ng-if="userData.length"><h3>Uploaded Datasets</h3><ul><li ng-repeat="dataset in userData track by dataset.id" ng-class="{selected: Dataset.currentDataset.id === dataset.id}"><a class="dataset" ng-click="selectDataset(dataset)" ng-disabled="Dataset.currentDataset.id === dataset.id"><i class="fa fa-database"></i> <strong>{{dataset.name}}</strong></a> <span ng-if="dataset.description">{{dataset.description}}</span> <strong ng-if="Dataset.currentDataset === dataset">(selected)</strong></li></ul></div><h3>Explore a Sample Dataset</h3><ul class="loaded-dataset-list"><li ng-repeat="dataset in sampleData track by dataset.id" ng-class="{selected: Dataset.currentDataset.id === dataset.id}"><a class="dataset" ng-click="selectDataset(dataset)" ng-disabled="Dataset.currentDataset.id === dataset.id"><i class="fa fa-database"></i> <strong>{{dataset.name}}</strong></a> <strong ng-if="Dataset.currentDataset === dataset">(selected)</strong> <em ng-if="dataset.description">{{dataset.description}}</em></li></ul></div>'),e.put("dataset/datasetmodal.html",'<modal id="dataset-modal" max-width="800px"><div class="modal-header"><modal-close-button></modal-close-button><h2>Add Dataset</h2></div><div class="modal-main"><tabset><tab heading="Change Dataset"><change-loaded-dataset></change-loaded-dataset></tab><tab heading="Paste or Upload Data"><paste-dataset></paste-dataset></tab><tab heading="From URL"><add-url-dataset></add-url-dataset></tab><tab heading="From Myria"><add-myria-dataset></add-myria-dataset></tab></tabset></div></modal>'),e.put("dataset/datasetselector.html",'<button id="select-data" class="small-button select-data" ng-click="loadDataset();">Change</button>'),e.put("dataset/filedropzone.html",'<div class="dropzone" ng-transclude=""></div>'),e.put("dataset/pastedataset.html",'<div class="paste-data"><file-dropzone dataset="dataset" max-file-size="10" valid-mime-types="[text/csv, text/json, text/tsv]"><div class="upload-data"><div class="form-group"><label for="dataset-file">File</label> <input type="file" id="dataset-file" accept="text/csv,text/tsv"></div><p>Upload a CSV, or paste data in <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> format into the fields.</p><div class="dropzone-target"><p>Drop CSV file here</p></div></div><form ng-submit="addDataset()"><div class="form-group"><label for="dataset-name">Name</label> <input type="name" ng-model="dataset.name" id="dataset-name" required=""></div><div class="form-group"><textarea ng-model="dataset.data" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 17, \'blur\': 0 }}" required="">\n      </textarea></div><button type="submit">Add data</button></form></file-dropzone></div>'),e.put("fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCountCaret || fieldDef.aggregate!==\'count\'}"><i class="fa fa-caret-down" ng-show="showCaret"></i> <span class="type fa {{icon}}" ng-show="showType" title="{{typeNames[fieldDef.type]}}"></span></span> <span ng-if="fieldDef.aggregate!==\'count\'" class="field-info-text"><span ng-if="func(fieldDef)" class="field-func" ng-class="{any: fieldDef._any}">{{ func(fieldDef) }}</span><span class="field-name" ng-class="{hasfunc: func(fieldDef), any: fieldDef._any}">{{ fieldDef.field | underscore2space }}</span></span> <span ng-if="fieldDef.aggregate===\'count\'" class="field-count field-info-text"><span class="field-name">COUNT</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span> <span class="no-shrink info" ng-show="showInfo"><i ng-if="fieldDef.aggregate !== \'count\' && containsType([vlType.NOMINAL, vlType.ORDINAL], fieldDef.type)" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{fieldDef.field}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min}}<br> <strong>Max:</strong> {{stats.max}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="fieldDef.aggregate !== \'count\' && fieldDef.type === vlType.TEMPORAL" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{fieldDef.field}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | date: short}}<br> <strong>Max:</strong> {{stats.max | date: short}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="fieldDef.aggregate !== \'count\' && fieldDef.type === vlType.QUANTITATIVE" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{fieldDef.field}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | number}}<br> <strong>Max:</strong> {{stats.max | number}}<br> <strong>Stdev:</strong> {{stats.stdev | number:2}}<br> <strong>Mean:</strong> {{stats.mean | number:2}}<br> <strong>Median:</strong> {{stats.median | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i><i ng-if="fieldDef.aggregate === \'count\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Count:</strong> {{stats.max}} </div>" tooltip-side="right"></i></span></span></span>'),e.put("modal/modal.html",'<div class="modal" ng-if="isOpen"><div class="modal-wrapper" style="{{wrapperStyle}}" ng-transclude=""></div></div>'),e.put("modal/modalclosebutton.html",'<div class="right"><a ng-click="closeModal()" class="right">Close</a></div>'),e.put("tabs/tab.html",'<div ng-if="active" ng-transclude=""></div>'),e.put("tabs/tabset.html",'<div class="tab-container"><div><a class="tab" ng-repeat="tab in tabset.tabs" ng-class="{\'active\': tab.active}" ng-click="tabset.showTab(tab)">{{tab.heading}}</a></div><div class="tab-contents" ng-transclude=""></div></div>'),e.put("vlplot/vlplot.html",'<div class="vl-plot" id="vis-{{visId}}" ng-class="{ fit: !alwaysScrollable && !overflow && (maxHeight && (!height || height <= maxHeight)) && (maxWidth && (!width || width <= maxWidth)), overflow: alwaysScrollable || overflow || (maxHeight && height && height > maxHeight) || (maxWidth && width && width > maxWidth), scroll: alwaysScrollable || unlocked || hoverFocus }" ng-mousedown="unlocked=!thumbnail" ng-mouseup="unlocked=false" ng-mouseover="mouseover()" ng-mouseout="mouseout()"><div class="vis-tooltip" ng-show="tooltipActive"><table><tr ng-repeat="p in data"><td class="key">{{p[0]}}</td><td class="value"><b>{{p[1]}}</b></td></tr></table></div></div>'),e.put("vlplotgroup/vlplotgroup.html",'<div class="vl-plot-group vflex"><div ng-show="showExpand || fieldSet || showTranspose || showBookmark && Bookmarks.isSupported || showToggle" class="vl-plot-group-header no-shrink"><div class="field-set-info"><field-info ng-repeat="fieldDef in fieldSet" ng-if="fieldSet" field-def="fieldDef" show-type="true" ng-class="{ selected: alwaysSelected || (isSelected && isSelected(fieldDef.field)), unselected: isSelected && !isSelected(fieldDef.field), highlighted: (highlighted||{})[fieldDef.field] }" ng-mouseover="(highlighted||{})[fieldDef.field] = true" ng-mouseout="(highlighted||{})[fieldDef.field] = false"></field-info></div><div class="toolbox"><a ng-if="consts.debug && showDebug" class="command debug"><i class="fa fa-wrench" ng-click="shCopied=\'\'; vlCopied=\'\'; vgCopied=\'\';" ng-mouseover="initializePopup();"></i></a><vl-plot-group-popup ng-if="consts.debug && showDebug && renderPopup"></vl-plot-group-popup><a ng-if="showMark" class="command disabled"><i class="fa fa-font"></i> <i class="fa fa-line-chart"></i> <i class="fa fa-area-chart"></i> <i class="fa fa-bar-chart"></i> <i class="fa fa-circle-o"></i></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'x\')" class="command" ng-click="log.toggle(chart.vlSpec, \'x\')" ng-class="{active: log.active(chart.vlSpec, \'x\')}"><i class="fa fa-long-arrow-right"></i> <small>Log X</small></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'y\')" class="command" ng-click="log.toggle(chart.vlSpec, \'y\')" ng-class="{active: log.active(chart.vlSpec, \'y\')}"><i class="fa fa-long-arrow-up"></i> <small>Log Y</small></a> <a ng-if="showSort && chart.vlSpec && toggleSort.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleSort.toggle(chart.vlSpec)"><i class="fa sort" ng-class="toggleSortClass(chart.vlSpec)"></i> <small ng-if="showLabel">Sort</small></a> <a ng-if="showFilterNull && chart.vlSpec && toggleFilterNull.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleFilterNull(chart.vlSpec)" ng-class="{active: chart.vlSpec && chart.vlSpec.cfg.filterNull.O}"><i class="fa fa-filter"></i> <small ng-if="showLabel">Filter</small> <small>NULL</small></a> <a ng-if="showTranspose" class="command" ng-click="transpose()"><i class="fa fa-refresh transpose"></i> <small ng-if="showLabel">Swap X/Y</small></a> <a ng-if="showBookmark && Bookmarks.isSupported" class="command" ng-click="Bookmarks.toggle(chart)" ng-class="{disabled: !chart.vlSpec.encoding, active: Bookmarks.isBookmarked(chart.shorthand)}"><i class="fa fa-bookmark"></i> <small ng-if="showLabel">Bookmark</small></a> <a ng-if="showExpand" ng-click="expandAction()" class="command"><i class="fa fa-expand"></i></a></div></div><vl-plot class="flex-grow-1" data-fieldset="{fieldSet.key}}" chart="chart" disabled="disabled" is-in-list="isInList" always-scrollable="alwaysScrollable" config-set="{{configSet||\'small\'}}" max-height="maxHeight" max-width="maxWidth" overflow="overflow" priority="priority" rescale="rescale" thumbnail="thumbnail" tooltip="tooltip"></vl-plot></div>'),e.put("vlplotgroup/vlplotgrouppopup.html",'<div class="drop-container"><div class="popup-menu popup-command no-shrink dev-tool"><div class="command debug"><span class="debug">Vls</span> <a class="debug" ui-zeroclip="" zeroclip-copied="shCopied=\'(Copied)\'" zeroclip-model="chart.shorthand">Copy</a> / <a class="debug" ng-click="logCode(\'VL shorthand\', chart.shorthand); shCopied=\'(Logged)\';">Log</a> <span>{{shCopied}}</span></div><div class="command debug"><span class="debug">Vl</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vlCopied=\'(Copied)\'" zeroclip-model="chart.cleanSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega-Lite\', chart.cleanSpec); vlCopied=\'(Logged)\';">Log</a> <span>{{vlCopied}}</span></div><div class="command debug"><span class="debug">Vg</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vgCopied=\'(Copied)\'" zeroclip-model="chart.vgSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega\', chart.vgSpec); vgCopied=\'(Logged)\';">Log</a> <span>{{vgCopied}}</span></div><a class="command debug" ng-href="{{ {type:\'vl\', spec: chart.cleanSpec} | reportUrl }}" target="_blank">Report Bad Render</a> <a ng-click="showFeature=!showFeature" class="command debug">{{chart.score}}</a><div ng-repeat="f in chart.scoreFeatures track by f.reason">[{{f.score}}] {{f.reason}}</div></div></div>')}])}(),function(){"use strict";angular.module("vlui").directive("alertMessages",["Alerts",function(e){return{templateUrl:"alertmessages/alertmessages.html",restrict:"E",scope:{},link:function(t){t.Alerts=e}}}])}(),function(){"use strict";angular.module("vlui").service("Alerts",["$timeout","_",function(e,t){var a={};return a.alerts=[],a.add=function(n,o){var i={msg:n};a.alerts.push(i),o&&e(function(){var e=t.findIndex(a.alerts,i);a.closeAlert(e)},o)},a.closeAlert=function(e){a.alerts.splice(e,1)},a}])}(),function(){"use strict";angular.module("vlui").directive("bookmarkList",["Bookmarks","consts","Logger",function(e,t,a){return{templateUrl:"bookmarklist/bookmarklist.html",restrict:"E",replace:!0,scope:{highlighted:"="},link:function(n){a.logInteraction(a.actions.BOOKMARK_OPEN),n.logBookmarksClosed=function(){a.logInteraction(a.actions.BOOKMARK_CLOSE)},n.Bookmarks=e,n.consts=t}}}])}(),function(){"use strict";angular.module("vlui").service("Bookmarks",["_","vl","localStorageService","Logger","Dataset",function(e,t,a,n,o){var i=function(){this.dict={},this.length=0,this.isSupported=a.isSupported},l=i.prototype;return l.updateLength=function(){this.length=Object.keys(this.dict).length},l.save=function(){a.set("bookmarks",this.dict)},l.load=function(){this.dict=a.get("bookmarks")||{},this.updateLength()},l.clear=function(){this.dict={},this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARK_CLEAR)},l.toggle=function(e){var t=e.shorthand;this.dict[t]?this.remove(e):this.add(e)},l.add=function(t){var a=t.shorthand;console.log("adding",t.vlSpec,a),t.timeAdded=(new Date).getTime(),t.stats=o.stats,this.dict[a]=e.cloneDeep(t),this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARK_ADD,a)},l.remove=function(e){var t=e.shorthand;console.log("removing",e.vlSpec,t),delete this.dict[t],this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARK_REMOVE,t)},l.isBookmarked=function(e){return e in this.dict},new i}])}(),function(){"use strict";angular.module("vlui").factory("Config",["vl","_",function(e,t){var a={};return a.schema=e.schema.schema.properties.config,a.dataschema=e.schema.schema.properties.data,a.data=e.schema.util.instantiate(a.dataschema),a.config=e.schema.util.instantiate(a.schema),a.getConfig=function(){return t.cloneDeep(a.config)},a.getData=function(){return a.data},a.large=function(){return{singleWidth:400,singleHeight:400,largeBandMaxCardinality:20}},a.small=function(){return{}},a.updateDataset=function(e,t){e.values?(a.data.values=e.values,delete a.data.url,a.data.formatType=void 0):(a.data.url=e.url,delete a.data.values,a.data.formatType=t)},a}])}(),function(){"use strict";angular.module("vlui").directive("addMyriaDataset",["$http","Dataset","consts",function(e,t,a){return{templateUrl:"dataset/addmyriadataset.html",restrict:"E",require:"?^^modal",replace:!0,scope:!0,link:function(n,o,i,l){function r(){l&&l.close()}n.myriaRestUrl=a.myriaRest,n.myriaDatasets=[],n.myriaDataset=null,n.loadDatasets=function(t){return e.get(n.myriaRestUrl+"/dataset/search/?q="+t).then(function(e){n.myriaDatasets=e.data})},n.loadDatasets(""),n.optionName=function(e){return e.userName+":"+e.programName+":"+e.relationName},n.addDataset=function(e){var a={group:"myria",name:e.relationName,url:n.myriaRestUrl+"/dataset/user-"+e.userName+"/program-"+e.programName+"/relation-"+e.relationName+"/data?format=json"};t.type="json",t.dataset=t.add(a),t.update(t.dataset),r()}}}}])}(),function(){"use strict";angular.module("vlui").directive("addUrlDataset",["Dataset","Logger",function(e,t){return{templateUrl:"dataset/addurldataset.html",restrict:"E",require:"?^^modal",replace:!0,scope:!0,link:function(a,n,o,i){function l(){i&&i.close()}a.addedDataset={group:"user"},a.addFromUrl=function(a){t.logInteraction(t.actions.DATASET_NEW_URL,a.url),e.dataset=e.add(a),e.update(e.dataset),l()}}}}])}(),function(){"use strict";angular.module("vlui").filter("inGroup",["_",function(e){return function(t,a){return e.where(t,{group:a})}}]),angular.module("vlui").directive("changeLoadedDataset",["Dataset","_",function(e,t){return{templateUrl:"dataset/changeloadeddataset.html",restrict:"E",require:"?^^modal",replace:!0,scope:!0,link:function(a,n,o,i){function l(){i&&i.close()}a.Dataset=e,a.userData=t.filter(e.datasets,function(e){return"sample"!==e.group}),a.sampleData=t.where(e.datasets,{group:"sample"}),a.$watch(function(){return e.datasets.length},function(){a.userData=t.filter(e.datasets,function(e){return"sample"!==e.group})}),a.selectDataset=function(t){e.update(t),l()}}}}])}(),function(){"use strict";function e(e){return e.reduce(function(e,t){return e[t.field]=t,e},{})}angular.module("vlui").factory("Dataset",["$http","$q","Alerts","_","dl","vl","SampleData","Config","Logger",function(t,a,n,o,i,l,r,s,c){var d={},u=r;d.datasets=u,d.dataset=u[1],d.currentDataset=void 0,d.dataschema=[],d.dataschema.byName={},d.stats={},d.type=void 0;var f={nominal:0,ordinal:0,geographic:2,temporal:3,quantitative:4};return d.fieldOrderBy={},d.fieldOrderBy.type=function(e){return"count"===e.aggregate?4:f[e.type]},d.fieldOrderBy.typeThenName=function(e){return d.fieldOrderBy.type(e)+"_"+("count"===e.aggregate?"~":e.field.toLowerCase())},d.fieldOrderBy.original=function(){return 0},d.fieldOrderBy.field=function(e){return e.field},d.fieldOrderBy.cardinality=function(e,t){return t[e.field].distinct},d.fieldOrder=d.fieldOrderBy.typeThenName,d.getSchema=function(e,t,a){var n=i.type.inferAll(e),r=o.reduce(n,function(e,a,n){var o={field:n,type:l.data.types[a],primitiveType:a};return o.type===l.type.QUANTITATIVE&&t[o.field].distinct<=5&&(o.type=l.type.ORDINAL),e.push(o),e},[]);return r=i.stablesort(r,a||d.fieldOrderBy.typeThenName,d.fieldOrderBy.field),r.push(l.fieldDef.count()),r},d.onUpdate=[],d.update=function(e){var n;return c.logInteraction(c.actions.DATASET_CHANGE,e.name),n=e.values?a(function(t,a){d.type=void 0,d.updateFromData(e,e.values),t()}):t.get(e.url,{cache:!0}).then(function(t){var a;o.isObject(t.data)?(a=t.data,d.type="json"):(a=i.read(t.data,{type:"csv"}),d.type="csv"),d.updateFromData(e,a)}),d.onUpdate.forEach(function(e){n=n.then(e)}),n.then(function(){s.updateDataset(e,d.type)}),n},d.updateFromData=function(t,a){d.data=a,d.currentDataset=t,d.stats=i.summary(a).reduce(function(e,t){return e[t.field]=t,e},{"*":{max:a.length,min:0}});for(var n in d.stats)"*"!==n&&(d.stats[n].sample=o.sample(o.pluck(d.data,n),7));d.dataschema=d.getSchema(d.data,d.stats),d.dataschema.byName=e(d.dataschema)},d.add=function(e){return e.id||(e.id=e.url),u.push(e),e},d}])}(),function(){"use strict";angular.module("vlui").directive("datasetModal",function(){return{templateUrl:"dataset/datasetmodal.html",restrict:"E",scope:!1}})}(),function(){"use strict";angular.module("vlui").directive("datasetSelector",["Modals","Logger",function(e,t){return{templateUrl:"dataset/datasetselector.html",restrict:"E",replace:!0,scope:{},link:function(a){a.loadDataset=function(){t.logInteraction(t.actions.DATASET_OPEN),e.open("dataset-modal")}}}}])}(),function(){"use strict";angular.module("vlui").constant("FileReader",window.FileReader).directive("fileDropzone",["Modals","Alerts","FileReader",function(e,t,a){function n(e,t){return!t||+t>e/1024/1024}function o(e,t){return!t||t.indexOf(e)>-1}return{templateUrl:"dataset/filedropzone.html",replace:!0,restrict:"E",transclude:!0,scope:{maxFileSize:"@",validMimeTypes:"@",dataset:"="},link:function(e,i){function l(i){if(!o(i.type,e.validMimeTypes))return void e.$apply(function(){t.add("Invalid file type. File must be one of following types: "+e.validMimeTypes)});if(!n(i.size,e.maxFileSize))return void e.$apply(function(){t.add("File must be smaller than "+e.maxFileSize+" MB")});var l=new a;l.onload=function(t){return e.$apply(function(e){e.dataset.data=t.target.result,e.dataset.name=i.name.replace(/\.\w+$/,"")})},l.onerror=function(){t.add("Error reading file")},l.readAsText(i)}e.dataset=e.dataset||{},i.on("dragover dragenter",function(e){e&&e.preventDefault(),e.originalEvent.dataTransfer.effectAllowed="copy"}),i.on("drop",function(e){e&&e.preventDefault(),l(e.originalEvent.dataTransfer.files[0])}),i.find('input[type="file"]').on("change",function(){l(this.files[0])})}}}])}(),function(){"use strict";angular.module("vlui").directive("pasteDataset",["Dataset","Logger","Config","_","dl",function(e,t,a,n,o){return{templateUrl:"dataset/pastedataset.html",restrict:"E",require:"?^^modal",replace:!0,scope:!0,link:function(a,n,i,l){function r(){l&&l.close()}a.dataset={name:"",data:""},a.addDataset=function(){var n=o.read(a.dataset.data,{type:"csv"}),i={id:Date.now(),name:a.dataset.name,values:n,group:"pasted"};t.logInteraction(t.actions.DATASET_NEW_PASTE,i.name),e.dataset=e.add(i),e.update(e.dataset),r()}}}}])}(),function(){angular.module("vlui").constant("SampleData",[{name:"Barley",description:"Barley yield by variety across the upper midwest in 1931 and 1932",url:"data/barley.json",id:"barley",group:"sample"},{name:"Cars",description:"Automotive statistics for a variety of car models between 1970 & 1982",url:"data/cars.json",id:"cars",group:"sample"},{name:"Crimea",url:"data/crimea.json",id:"crimea",group:"sample"},{name:"Driving",url:"data/driving.json",id:"driving",group:"sample"},{name:"Iris",
url:"data/iris.json",id:"iris",group:"sample"},{name:"Jobs",url:"data/jobs.json",id:"jobs",group:"sample"},{name:"Population",url:"data/population.json",id:"population",group:"sample"},{name:"Movies",url:"data/movies.json",id:"movies",group:"sample"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes",group:"sample"},{name:"Burtin",url:"data/burtin.json",id:"burtin",group:"sample"},{name:"Campaigns",url:"data/weball26.json",id:"weball26",group:"sample"}])}(),function(){"use strict";angular.module("vlui").directive("fieldInfo",["Dataset","Drop","vl","consts","_",function(e,t,a,n,o){return{templateUrl:"fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{fieldDef:"=",showType:"=",showInfo:"=",showCaret:"=",popupContent:"=",showRemove:"=",removeAction:"&",action:"&",disableCountCaret:"="},link:function(i,l){var r;switch(i.vlType=a.type,i.typeNames=n.typeNames,i.stats=e.stats[i.fieldDef.field],i.containsType=function(e,t){return o.contains(e,t)},i.fieldDef.type){case a.type.ORDINAL:i.icon="fa-font";break;case a.type.NOMINAL:i.icon="fa-font";break;case a.type.QUANTITATIVE:i.icon="icon-hash";break;case a.type.TEMPORAL:i.icon="fa-calendar"}i.clicked=function(e){i.action&&e.target!==l.find(".fa-caret-down")[0]&&e.target!==l.find("span.type")[0]&&i.action(e)},i.func=function(e){return e.aggregate||e.timeUnit||e.bin&&"bin"||e._aggregate||e._timeUnit||e._bin&&"bin"||e._any&&"auto"},i.$watch("popupContent",function(e){e&&(r&&r.destroy(),r=new t({content:e,target:l.find(".type-caret")[0],position:"bottom left",openOn:"click"}))}),i.$on("$destroy",function(){r&&r.destroy()})}}}])}(),function(){"use strict";angular.module("vlui").service("Logger",["$location","$window","consts","Analytics",function(e,t,a,n){var o={};return o.levels={OFF:{id:"OFF",rank:0},TRACE:{id:"TRACE",rank:1},DEBUG:{id:"DEBUG",rank:2},INFO:{id:"INFO",rank:3},WARN:{id:"WARN",rank:4},ERROR:{id:"ERROR",rank:5},FATAL:{id:"FATAL",rank:6}},o.actions={INITIALIZE:{category:"DATA",id:"INITIALIZE",level:o.levels.DEBUG},UNDO:{category:"DATA",id:"UNDO",level:o.levels.INFO},REDO:{category:"DATA",id:"REDO",level:o.levels.INFO},DATASET_CHANGE:{category:"DATA",id:"DATASET_CHANGE",level:o.levels.INFO},DATASET_OPEN:{category:"DATA",id:"DATASET_OPEN",level:o.levels.INFO},DATASET_NEW_PASTE:{category:"DATA",id:"DATASET_NEW_PASTE",level:o.levels.INFO},DATASET_NEW_URL:{category:"DATA",id:"DATASET_NEW_URL",level:o.levels.INFO},BOOKMARK_ADD:{category:"BOOKMARK",id:"BOOKMARK_ADD",level:o.levels.INFO},BOOKMARK_REMOVE:{category:"BOOKMARK",id:"BOOKMARK_REMOVE",level:o.levels.INFO},BOOKMARK_OPEN:{category:"BOOKMARK",id:"BOOKMARK_OPEN",level:o.levels.INFO},BOOKMARK_CLOSE:{category:"BOOKMARK",id:"BOOKMARK_CLOSE",level:o.levels.INFO},BOOKMARK_CLEAR:{category:"BOOKMARK",id:"BOOKMARK_CLEAR",level:o.levels.INFO},CHART_MOUSEOVER:{category:"CHART",id:"CHART_MOUSEOVER",level:o.levels.DEBUG},CHART_MOUSEOUT:{category:"CHART",id:"CHART_MOUSEOUT",level:o.levels.DEBUG},CHART_RENDER:{category:"CHART",id:"CHART_RENDER",level:o.levels.DEBUG},CHART_EXPOSE:{category:"CHART",id:"CHART_EXPOSE",level:o.levels.DEBUG},CHART_TOOLTIP:{category:"CHART",id:"CHART_TOOLTIP",level:o.levels.DEBUG},CHART_TOOLTIP_END:{category:"CHART",id:"CHART_TOOLTIP_END",level:o.levels.DEBUG},SORT_TOGGLE:{category:"CHART",id:"SORT_TOGGLE",level:o.levels.INFO},MARK_TOGGLE:{category:"CHART",id:"MARK_TOGGLE",level:o.levels.INFO},DRILL_DOWN_OPEN:{category:"CHART",id:"DRILL_DOWN_OPEN",level:o.levels.INFO},DRILL_DOWN_CLOSE:{category:"CHART",id:"DRILL_DOWN_CLOSE",level:o.levels.INFO},LOG_TOGGLE:{category:"CHART",id:"LOG_TOGGLE",level:o.levels.INFO},TRANSPOSE_TOGGLE:{category:"CHART",id:"TRANSPOSE_TOGGLE",level:o.levels.INFO},NULL_FILTER_TOGGLE:{category:"CHART",id:"NULL_FILTER_TOGGLE",level:o.levels.INFO},CLUSTER_SELECT:{category:"CHART",id:"CLUSTER_SELECT",level:o.levels.INFO},LOAD_MORE:{category:"CHART",id:"LOAD_MORE",level:o.levels.INFO},FIELDS_CHANGE:{category:"FIELDS",id:"FIELDS_CHANGE",level:o.levels.INFO},FIELDS_RESET:{category:"FIELDS",id:"FIELDS_RESET",level:o.levels.INFO},FUNC_CHANGE:{category:"FIELDS",id:"FUNC_CHANGE",level:o.levels.INFO},SPEC_CHANGE:{category:"POLESTAR",id:"SPEC_CHANGE",level:o.levels.DEBUG},FIELD_DROP:{category:"POLESTAR",id:"FIELD_DROP",level:o.levels.DEBUG},MARK_CHANGE:{category:"POLESTAR",id:"MARK_CHANGE",level:o.levels.DEBUG}},o.logInteraction=function(e,t,i){if(a.logging){var l=i?i.value:void 0;e.level.rank>=o.levels.INFO.rank&&(n.trackEvent(e.category,e.id,t,l),console.log("[Logging] ",e.id,t,i))}},o.logInteraction(o.actions.INITIALIZE,a.appId),o}])}(),function(){"use strict";angular.module("vlui").directive("modal",["$document","Modals",function(e,t){return{templateUrl:"modal/modal.html",restrict:"E",transclude:!0,scope:{autoOpen:"=",maxWidth:"@"},controller:["$scope",function(e){this.close=function(){e.isOpen=!1}}],link:function(a,n,o){function i(e){27===e.keyCode&&a.isOpen&&(a.isOpen=!1,a.$digest())}var l=o.id;a.maxWidth&&(a.wrapperStyle="max-width:"+a.maxWidth),a.isOpen=a.autoOpen,angular.element(e).on("keydown",i),t.register(l,a),a.$on("$destroy",function(){t.deregister(l)})}}}])}(),function(){"use strict";angular.module("vlui").directive("modalCloseButton",function(){return{templateUrl:"modal/modalclosebutton.html",restrict:"E",require:"^^modal",scope:{closeCallback:"&onClose"},link:function(e,t,a,n){e.closeModal=function(){n.close(),e.closeCallback&&e.closeCallback()}}}})}(),function(){"use strict";angular.module("vlui").factory("Modals",["$cacheFactory",function(e){var t=e("modals");return{register:function(e,a){return t.get(e)?void console.error("Cannot register two modals with id "+e):void t.put(e,a)},deregister:function(e){t.remove(e)},open:function(e){var a=t.get(e);return a?void(a.isOpen=!0):void console.error("Unregistered modal id "+e)},close:function(e){var a=t.get(e);return a?void(a.isOpen=!1):void console.error("Unregistered modal id "+e)},empty:function(){t.removeAll()},count:function(){return t.info().size}}}])}(),function(){"use strict";angular.module("vlui").directive("tab",function(){return{templateUrl:"tabs/tab.html",restrict:"E",require:"^^tabset",replace:!0,transclude:!0,scope:{heading:"@"},link:function(e,t,a,n){n.addTab(e)}}})}(),function(){"use strict";angular.module("vlui").directive("tabset",function(){return{templateUrl:"tabs/tabset.html",restrict:"E",transclude:!0,controller:function(){var e=this;this.tabs=[],this.addTab=function(t){t.active=0===e.tabs.length,e.tabs.push(t)},this.showTab=function(t){e.tabs.forEach(function(e){e.active=e===t})}},controllerAs:"tabset"}})}(),function(){"use strict";angular.module("vlui").directive("vlPlot",["dl","vl","vg","$timeout","$q","Dataset","Config","consts","_","$document","Logger","Heap","$window",function(e,t,a,n,o,i,l,r,s,c,d,u,f){function p(e,t){return e>m||t>m||e*t>v?"svg":"canvas"}var g=0,m=16383.5,v=67108864,h=new u(function(e,t){return t.priority-e.priority}),y=!1;return{templateUrl:"vlplot/vlplot.html",restrict:"E",scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"="},replace:!0,link:function(o,u){function m(t,a){a&&a.datum&&(o.tooltipPromise=n(function(){if(!a.datum._facetID){o.tooltipActive=!0,d.logInteraction(d.actions.CHART_TOOLTIP,a.datum),o.data=s(a.datum).omit("_prev","_id").pairs().value().map(function(t){return t[1]=e.isNumber(t[1])?N(t[1]):t[1],t}),o.$digest();var n=u.find(".vis-tooltip"),i=angular.element(c),l=n.width(),r=n.height();t.pageY+10+r<i.height()?n.css("top",t.pageY+10):n.css("top",t.pageY-10-r),t.pageX+10+l<i.width()?n.css("left",t.pageX+10):n.css("left",t.pageX-10-l)}},E))}function v(e,t){var a=u.find(".vis-tooltip");a.css("top",null),a.css("left",null),n.cancel(o.tooltipPromise),o.tooltipActive&&d.logInteraction(d.actions.CHART_TOOLTIP_END,t.datum),o.tooltipActive=!1,o.data=[],o.$digest()}function b(){var a=o.configSet||r.defaultConfigSet||{};if(o.chart.vlSpec){var n=s.cloneDeep(o.chart.vlSpec);e.extend(n.config,l[a]());var c=o.chart.stats||i.stats,d=n.encoding;if(d){if(d.y&&d.y.field&&[t.type.NOMINAL,t.type.ORDINAL].indexOf(d.y.type)>-1&&d.x){var u=c[d.y.field];u&&t.fieldDef.cardinality(d.y,c)>30&&((d.x.axis=d.x.axis||{}).orient="top")}(d.row||d.y&&c[d.y.field]&&t.fieldDef.cardinality(d.y,c)>10)&&((d.y.scale=d.y.scale||{}).bandWidth=12),(d.column||d.x&&c[d.x.field]&&t.fieldDef.cardinality(d.x,c)>10)&&((d.x.scale=d.x.scale||{}).bandWidth=12),d.color&&d.color.type===t.type.NOMINAL&&t.fieldDef.cardinality(d.x,c)>10&&((d.color.scale=d.color.scale||{}).range="category20")}return t.compile(n).spec}}function O(){return u.find(".vega > :first-child")}function A(){var e=O();if(o.rescale){o.$digest();var t=Math.max(.2,u.width()/o.width);1>t&&e.width(o.width*t).height(o.height*t)}else e.css("transform",null).css("transform-origin",null)}function D(){return o.chart.shorthand||(o.chart.vlSpec?t.shorthand.shorten(o.chart.vlSpec):"")}function S(){if(h.size()>0){var e=h.pop();e.parse()}else y=!1}function T(e){function t(){if(o.destroyed||o.disabled||o.isInList&&o.chart.fieldSetKey&&!o.isInList(o.chart.fieldSetKey))return console.log("cancel rendering",n),void S();var t=(new Date).getTime();a.parse.spec(e,function(a){try{var l=(new Date).getTime();C=null,C=a({el:u[0]}),r.useUrl||C.data({raw:i.data}),C.update();var s=u.find(".vega > :first-child");o.width=s.width(),o.height=s.height(),r.debug&&(f.views=f.views||{},f.views[n]=C),d.logInteraction(d.actions.CHART_RENDER,"",o.chart.vlSpec),A();var c=(new Date).getTime();console.log("parse spec",l-t,"charting",c-l,n),o.tooltip&&(C.on("mouseover",m),C.on("mouseout",v))}catch(p){console.error(p,JSON.stringify(e))}finally{S()}})}if(!e)return void(C&&(C.off("mouseover"),C.off("mouseout")));o.height=e.height,u||console.error("can not find vis element");var n=D();o.renderer=p(e),y?h.push({priority:o.priority||0,parse:t}):(y=!0,t())}var w=500,E=250;o.visId=g++,o.hoverPromise=null,o.tooltipPromise=null,o.hoverFocus=!1,o.tooltipActive=!1,o.destroyed=!1;var N=e.format.number("");o.mouseover=function(){o.hoverPromise=n(function(){d.logInteraction(d.actions.CHART_MOUSEOVER,"",o.chart.vlSpec),o.hoverFocus=!o.thumbnail},w)},o.mouseout=function(){o.hoverFocus&&d.logInteraction(d.actions.CHART_MOUSEOUT,"",o.chart.vlSpec),n.cancel(o.hoverPromise),o.hoverFocus=o.unlocked=!1};var C;o.$watch(function(){return s.omit(o.chart.vlSpec,"data")},function(){var e=o.chart.vgSpec=b();o.chart.cleanSpec||(o.chart.cleanSpec=t.spec.getCleanSpec(o.chart.vlSpec)),T(e)},!0),o.$on("$destroy",function(){console.log("vlplot destroyed"),C&&(C.off("mouseover"),C.off("mouseout"),C=null);var e=D();r.debug&&f.views&&delete f.views[e],o.destroyed=!0})}}}])}(),function(){"use strict";angular.module("vlui").directive("vlPlotGroup",["Bookmarks","consts","dl","vl","Dataset","Logger","_",function(e,t,a,n,o,i,l){return{templateUrl:"vlplotgroup/vlplotgroup.html",restrict:"E",replace:!0,controller:["$scope","$element",function(e,t){this.getDropTarget=function(){return t.find(".fa-wrench")[0]}}],scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"=",fieldSet:"=",showBookmark:"@",showDebug:"=",showExpand:"=",showFilterNull:"@",showLabel:"@",showLog:"@",showMark:"@",showSort:"@",showTranspose:"@",alwaysSelected:"=",isSelected:"=",highlighted:"=",expandAction:"&"},link:function(r){r.Bookmarks=e,r.consts=t,r.Dataset=o,r.renderPopup=!1,r.initializePopup=l.once(function(){r.renderPopup=!0}),r.logCode=function(e,t){console.log(e+":\n\n",JSON.stringify(t))},r.log={},r.log.support=function(e,t){if(!e)return!1;var a=e.encoding,o=a[t];return o&&o.type===n.type.QUANTITATIVE&&!o.bin},r.log.toggle=function(e,t){if(r.log.support(e,t)){var a=e.encoding[t],n=a.scale=a.scale||{};n.type="log"===n.type?"linear":"log",i.logInteraction(i.actions.LOG_TOGGLE,r.chart.shorthand)}},r.log.active=function(e,t){if(r.log.support(e,t)){var a=e.encoding[t],n=a.scale=a.scale||{};return"log"===n.type}},r.toggleFilterNull=function(e){i.logInteraction(i.actions.NULL_FILTER_TOGGLE,r.chart.shorthand),e.config=e.config||{},e.config.filterNull=e.config.filterNull||{nominal:!1,ordinal:!1,temporal:!0,quantitative:!0},e.config.filterNull.ordinal=!e.config.filterNull.ordinal,e.config.filterNull.nominal=!e.config.filterNull.nominal},r.toggleFilterNull.support=function(e,t){var a=n.spec.fieldDefs(e);for(var o in a){var i=a[o];if(l.contains([n.type.ORDINAL,n.type.NOMINAL],i.type)&&i.name in t&&t[i.name].missing>0)return!0}return!1};var s=r.toggleSort={};s.modes=["ordinal-ascending","ordinal-descending","quantitative-ascending","quantitative-descending","custom"],s.toggle=function(e){i.logInteraction(i.actions.SORT_TOGGLE,r.chart.shorthand);var t=s.mode(e),a=s.modes.indexOf(t),n=(a+1)%(s.modes.length-1),o=s.modes[n];console.log("toggleSort",t,o);var l=s.channels(e);e.encoding[l.ordinal].sort=s.getSort(o,e)},s.getSort=function(e,t){if("ordinal-ascending"===e)return"ascending";if("ordinal-descending"===e)return"descending";var a=s.channels(t),n=t.encoding[a.quantitative];return"quantitative-ascending"===e?{op:n.aggregate,field:n.field,order:"ascending"}:"quantitative-descending"===e?{op:n.aggregate,field:n.field,order:"descending"}:null},s.mode=function(e){var t=s.channels(e),n=e.encoding[t.ordinal].sort;if(void 0===n)return"ordinal-ascending";for(var o=0;o<s.modes.length-1;o++){var i=s.modes[o],r=s.getSort(i,e);if(l.isEqual(n,r))return i}return a.isObject(n)&&n.op&&n.field?"custom":(console.error("invalid mode"),null)},s.channels=function(e){return e.encoding.x.type===n.type.NOMINAL||e.encoding.x.type===n.type.ORDINAL?{ordinal:"x",quantitative:"y"}:{ordinal:"y",quantitative:"x"}},s.support=function(e,t){var a=e.encoding;return!n.encoding.has(a,"row")&&!n.encoding.has(a,"column")&&n.encoding.has(a,"x")&&n.encoding.has(a,"y")&&n.spec.alwaysNoOcclusion(e,t)?a.x.type!==n.type.NOMINAL&&a.x.type!==n.type.ORDINAL||!n.fieldDef.isMeasure(a.y)?a.y.type!==n.type.NOMINAL&&a.y.type!==n.type.ORDINAL||!n.fieldDef.isMeasure(a.x)?!1:"y":"x":!1},r.toggleSortClass=function(e){if(!e||!s.support(e,o.stats))return"invisible";var t=e&&s.channels(e).ordinal,a=e&&s.mode(e),n="x"===t?"sort-x ":"";switch(a){case"ordinal-ascending":return n+"fa-sort-alpha-asc";case"ordinal-descending":return n+"fa-sort-alpha-desc";case"quantitative-ascending":return n+"fa-sort-amount-asc";case"quantitative-descending":return n+"fa-sort-amount-desc";default:return n+"fa-sort"}},r.transpose=function(){i.logInteraction(i.actions.TRANSPOSE_TOGGLE,r.chart.shorthand),n.spec.transpose(r.chart.vlSpec)},r.$on("$destroy",function(){r.chart=null})}}}])}(),function(){"use strict";angular.module("vlui").directive("vlPlotGroupPopup",["Drop",function(e){return{templateUrl:"vlplotgroup/vlplotgrouppopup.html",restrict:"E",require:"^^vlPlotGroup",scope:!1,link:function(t,a,n,o){var i=new e({content:a.find(".dev-tool")[0],target:o.getDropTarget(),position:"bottom right",openOn:"click",constrainToWindow:!0});t.$on("$destroy",function(){i.destroy()})}}}])}(),function(){"use strict";angular.module("vlui").filter("reportUrl",["compactJSONFilter","_","consts",function(e,t,a){function n(a){var n="https://docs.google.com/forms/d/1T9ZA14F3mmzrHR7JJVUKyPXzrMqF54CjLIOjv2E7ZEM/viewform?";if(a.fields){var o=encodeURI(e(t.values(a.fields)));n+="entry.1245199477="+o+"&"}if(a.spec){var i=t.omit(a.spec,"config");i=encodeURI(e(i)),n+="entry.1323680136="+i+"&"}if(a.spec2){var l=t.omit(a.spec2,"config");l=encodeURI(e(l)),n+="entry.853137786="+l+"&"}var r="entry.1940292677=";switch(a.type){case"vl":n+=r+"Visualization+Rendering+(Vegalite)&";break;case"vr":n+=r+"Recommender+Algorithm+(Visrec)&";break;case"fv":n+=r+"Recommender+UI+(FacetedViz)&"}return n}function o(a){var n="https://docs.google.com/forms/d/1xKs-qGaLZEUfbTmhdmSoS13OKOEpuu_NNWE5TAAml_Y/viewform?";if(a.spec){var o=t.omit(a.spec,"config");o=encodeURI(e(o)),n+="entry.1245199477="+o+"&"}return n}return"voyager"===a.appId?n:o}])}(),function(){"use strict";angular.module("vlui").filter("compactJSON",["JSON3",function(e){return function(t){return e.stringify(t,null,"  ",80)}}])}(),function(){"use strict";angular.module("vlui").filter("underscore2space",function(){return function(e){return e?e.replace(/_+/g," "):""}})}(),function(){"use strict";angular.module("vlui").filter("encodeURI",function(){return function(e){return window.encodeURI(e)}})}();