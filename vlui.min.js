!function(){"use strict";angular.module("vlui",["LocalStorageModule","angular-websql"]).constant("_",window._).constant("dl",window.dl).constant("vl",window.vl).constant("vg",window.vg).constant("Papa",window.Papa).constant("Blob",window.Blob).constant("URL",window.URL).constant("Drop",window.Drop).constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!1,defaultConfigSet:"large",appId:"polestar"})}(),function(){angular.module("vlui").run(["$templateCache",function(t){t.put("fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCountOrOCaret || (field.type!==\'O\' && field.aggr!==\'count\')}"><i class="fa fa-caret-down" ng-show="showCaret"></i> <span class="type icon-small icon-type-{{typeNames[field.type]}}" ng-show="showType" title="{{typeNames[field.type]}}">{{field.type}}</span></span> <span ng-if="field.aggr!==\'count\'" class="field-info-text"><span ng-if="func(field)" class="field-func" ng-class="{any: field._any}">{{ func(field) }}</span><span class="field-name" ng-class="{hasfunc: func(field), any: field._any}">{{ field.name | underscore2space }}</span></span> <span ng-if="field.aggr===\'count\'" class="field-count field-info-text"><span class="field-name">COUNT</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span> <span class="no-shrink info" ng-show="showInfo"><i ng-if="field.aggr !== \'count\' && field.type === \'O\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min}}<br> <strong>Max:</strong> {{stats.max}}<br> <strong>Max length:</strong> {{stats.maxlength | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggr !== \'count\' && field.type === \'T\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | date: short}}<br> <strong>Max:</strong> {{stats.max | date: short}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggr !== \'count\' && field.type === \'Q\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | number}}<br> <strong>Max:</strong> {{stats.max | number}}<br> <strong>Stdev:</strong> {{stats.stdev | number:2}}<br> <strong>Mean:</strong> {{stats.mean | number:2}}<br> <strong>Median:</strong> {{stats.median | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i><i ng-if="field.aggr === \'count\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-content="<div class=\'tooltip-content\'> <strong>Count:</strong> {{count}} </div>" tooltip-side="right"></i></span></span></span>')}])}(),function(){"use strict";angular.module("vlui").service("Alerts",function(t,n){var e={};return e.alerts=[],e.add=function(a,s){var i={msg:a};e.alerts.push(i),s&&t(function(){var t=n.findIndex(e.alerts,i);e.closeAlert(t)},s)},e.closeAlert=function(t){e.alerts.splice(t,1)},e})}(),function(){"use strict";angular.module("vlui").service("Bookmarks",function(t,n,e,a){var s=function(){this.dict={},this.length=0},i=s.prototype;return i.updateLength=function(){this.length=Object.keys(this.dict).length},i.save=function(){e.set("bookmarks",this.dict)},i.load=function(){this.dict=e.get("bookmarks")||{},this.updateLength()},i.clear=function(){this.dict={},this.updateLength(),this.save(),a.logInteraction(a.actions.BOOKMARKS_CLEAR)},i.toggle=function(t){var n=t.shorthand;this.dict[n]?this.remove(t):this.add(t)},i.add=function(n){var e=n.shorthand;console.log("adding",n.vlSpec,e),n.timeAdded=(new Date).getTime(),this.dict[e]=t.cloneDeep(n),this.updateLength(),this.save(),a.logInteraction(a.actions.BOOKMARK_ADD,e)},i.remove=function(t){var n=t.shorthand;console.log("removing",t.vlSpec,n),delete this.dict[n],this.updateLength(),this.save(),a.logInteraction(a.actions.BOOKMARK_REMOVE,n)},i.isBookmarked=function(t){return t in this.dict},new s})}(),function(){"use strict";function t(t){return t.reduce(function(t,n){return t[n.name]=n,t},{})}var n=[{name:"Barley",url:"data/barley.json",id:"barley"},{name:"Cars",url:"data/cars.json",id:"cars"},{name:"Crimea",url:"data/crimea.json",id:"crimea"},{name:"Driving",url:"data/driving.json",id:"driving"},{name:"Iris",url:"data/iris.json",id:"iris"},{name:"Jobs",url:"data/jobs.json",id:"jobs"},{name:"Population",url:"data/population.json",id:"population"},{name:"Movies",url:"data/movies.json",id:"movies"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes"},{name:"Burtin",url:"data/burtin.json",id:"burtin"},{name:"Budget 2016",url:"data/budget.json",id:"budget"},{name:"Climate Normals",url:"data/climate.json",id:"climate"},{name:"Campaigns",url:"data/weball26.json",id:"weball26"}];angular.module("vlui").factory("Dataset",function(e,a,s,i,o,r){var l={};return l.datasets=n,l.dataset=n[1],l.dataschema=[],l.dataschema.byName={},l.stats={},l.type=void 0,l.typeNames={O:"text",Q:"number",T:"time",G:"geo"},l.fieldOrder=r.field.order.typeThenName,l.getSchema=function(t,n,e){var a=o.read.types(t),i=s.reduce(a,function(t,n,e){return t.push({name:e,type:r.data.types[n]}),t},[]);return i=o.stablesort(i,e||r.field.order.typeThenName,r.field.order.name),i.push(r.field.count()),i.forEach(function(t){var e=n[t.name];void 0!==e&&"Q"===t.type&&e.distinct<=20&&(e.distinct<(e.count-e.numNulls)/50||e.distinct<=7)&&(t.type="O")}),i},l.getStats=function(t){var n=o.summary(t);return n.reduce(function(t,n){return t[n.field]=n,t},{count:t.length})},l.update=function(n){return e.get(n.url,{cache:!0}).then(function(n){if(s.isObject(n.data))l.data=n.data,l.type="json";else{var e=i.parse(n.data,{dynamicTyping:!0,header:!0});if(0!==e.errors.length)return s.each(e.errors,function(t){a.add(t.message,2e3)}),void 0;l.data=e.data,l.type="csv"}l.stats=l.getStats(l.data),l.dataschema=l.getSchema(l.data,l.stats),l.dataschema.byName=t(l.dataschema)})},l.add=function(t){t.id||(t.id=t.url),n.push(t)},l})}(),function(){"use strict";angular.module("vlui").directive("fieldInfo",function(t,n){return{templateUrl:"fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{field:"=",showType:"=",showInfo:"=",showCaret:"=",popupContent:"=",showRemove:"=",removeAction:"&",action:"&",disableCountOrOCaret:"="},link:function(e,a){var s;e.typeNames=t.typeNames,e.stats=t.stats[e.field.name],e.count=t.stats.count,e.clicked=function(t){e.action&&t.target!==a.find(".fa-caret-down")[0]&&t.target!==a.find("span.type")[0]&&e.action(t)},e.func=function(t){return t.aggr||t.fn||t.bin&&"bin"||t._aggr||t._fn||t._bin&&"bin"||t._any&&"auto"},e.$watch("popupContent",function(t){t&&(s=new n({content:t,target:a.find(".type-caret")[0],position:"bottom left",openOn:"click"}))})}}})}(),function(){"use strict";angular.module("vlui").service("Logger",function(t,n,e,a,s,i,o){var r={},l=t.search().user;return r.db=e.openDatabase("logs","1.0","Logs",2097152),r.tableName="log_"+a.appId,r.actions={UNDO:"UNDO",REDO:"REDO",DATASET_CHANGE:"DATASET_CHANGE",CHART_MOUSEOVER:"CHART_MOUSEOVER",CHART_MOUSEOUT:"CHART_MOUSEOUT",CHART_RENDER:"CHART_RENDER",CHART_EXPOSE:"CHART_EXPOSE",CHART_TOOLTIP:"CHART_TOOLTIP",BOOKMARK_ADD:"BOOKMARK_ADD",BOOKMARK_REMOVE:"BOOKMARK_REMOVE",BOOKMARKS_CLEAR:"BOOKMARKS_CLEAR",NULL_FILTER_TOGGLE:"NULL_FILTER_TOGGLE",TRANSPOSE_TOGGLE:"TRANSPOSE_TOGGLE",SORT_TOGGLE:"SORT_TOGGLE",MARKTYPE_TOGGLE:"MARKTYPE_TOGGLE",LOG_TOGGLE:"LOG_TOGGLE",FUNC_CHANGE:"FUNC_CHANGE",SPEC_CHANGE:"SPEC_CHANGE",FIELD_DROP:"FIELD_DROP",MARK_CHANGE:"MARK_CHANGE",FIELDS_CHANGE:"FIELDS_CHANGE",FIELDS_RESET:"FIELDS_RESET",DRILL_DOWN_OPEN:"DRILL_DOWN_OPEN",DRILL_DOWN_CLOSE:"DRILL_DOWN_CLOSE",CLUSTER_SELECT:"CLUSTER_SELECT",LOAD_MORE:"LOAD_MORE"},r.createTableIfNotExists=function(){r.db.createTable(r.tableName,{userid:{type:"INTEGER","null":"NOT NULL"},time:{type:"TIMESTAMP","null":"NOT NULL","default":"CURRENT_TIMESTAMP"},action:{type:"TEXT","null":"NOT NULL"},data:{type:"TEXT"},diff:{type:"TEXT"}})},r.clear=function(){var t=n.confirm("Really clear the logs?");t===!0&&(r.db.dropTable(r.tableName),r.createTableIfNotExists())},r.export=function(){r.db.selectAll(r.tableName).then(function(t){if(0===t.rows.length)return console.warn("No logs"),void 0;for(var n=[],e=0;e<t.rows.length;e++)n.push(t.rows.item(e));var a=s.unparse(n),l=new i([a],{type:"text/csv"}),c=o.createObjectURL(l),d=angular.element("<a/>");d.attr({href:c,target:"_blank",download:r.tableName+".csv"})[0].click()})},r.logInteraction=function(t,n,e){if(a.logging){var s={userid:l,action:t};void 0!==n&&(s.data=JSON.stringify(n)),void 0!==e&&(s.diff=JSON.stringify(e)),r.db.insert(r.tableName,s).then(function(){})}},r.createTableIfNotExists(),r})}(),function(){"use strict";angular.module("vlui").filter("underscore2space",function(){return function(t){return t?t.replace(/_+/g," "):""}})}();