!function(){"use strict";angular.module("vlui",["LocalStorageModule","ui.select","angular-websql"]).constant("_",window._).constant("dl",window.dl).constant("vl",window.vl).constant("vg",window.vg).constant("Papa",window.Papa).constant("Blob",window.Blob).constant("URL",window.URL).constant("Drop",window.Drop).constant("Heap",window.Heap).constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!1,defaultConfigSet:"large",appId:"vlui",priority:{bookmark:0,popup:0,vislist:1e3},myriaRest:"http://ec2-52-1-38-182.compute-1.amazonaws.com:8753"})}(),function(){angular.module("vlui").run(["$templateCache",function(t){t.put("bookmarklist/bookmarklist.html",'<div class="modal" ng-show="active"><div class="wrapper"><div class="vflex full-width full-height" id="evs" ng-if="active"><div class="modal-header no-shrink card no-top-margin no-right-margin"><div class="right"><a ng-click="deactivate()" class="right">Close</a></div><h2 class="no-bottom-margin">Bookmarks ({{ Bookmarks.length }})</h2><a ng-click="Bookmarks.clear()"><i class="fa fa-trash-o"></i> Clear all</a></div><div class="flex-grow-1 scroll-y"><div ng-if="Bookmarks.length > 0" class="vis-list hflex flex-wrap"><vl-plot-group ng-repeat="chart in Bookmarks.dict | orderObjectBy : \'timeAdded\' : false" class="wrapped-vl-plot-group" chart="chart" field-set="chart.fieldSet" show-bookmark="true" show-debug="consts.debug" show-expand="false" always-selected="true" highlighted="highlighted" ng-mouseover="(highlighted||{})[field.name] = true" ng-mouseout="(highlighted||{})[field.name] = false" overflow="true" tooltip="true" priority="consts.priority.bookmark"></vl-plot-group></div><div class="vis-list-empty" ng-if="Bookmarks.length === 0">You have no bookmarks</div></div></div></div></div>'),t.put("dataset/addmyriadataset.html",'<div class="add-myria-dataset"><h3>Add a dataset from Myria</h3><p>Select a dataset from the Myria instance at <code>{{myriaRestUrl}}</code>.</p><form><ui-select ng-model="$parent.myriaDataset" style="width: 300px" theme="selectize" ng-disabled="disabled" reset-search-input="false"><ui-select-match placeholder="Select dataset...">{{$select.selected.relationName}}</ui-select-match><ui-select-choices id="dataset-name" repeat="dataset in myriaDatasets" refresh="loadDatasets($select.search)" refresh-delay="100">{{ dataset.userName}}:{{dataset.programName}}:{{dataset.relationName }}</ui-select-choices></ui-select><button type="submit" ng-click="addFromMyria(myriaDataset)">Add dataset</button></form></div>'),t.put("dataset/addurldataset.html",'<div class="add-url-dataset"><h3>Add a dataset from URL</h3><p>Add the name of the dataset and the URL to a <b>JSON</b> or <b>CSV</b> (with header) file. Make sure that the formatting is correct and clean the data before adding it to Voyager. The added dataset is only visible to you.</p><form><div class="form-group"><label for="dataset-name">Name</label> <input ng-model="addedDataset.name" id="dataset-name" type="text"></div><div class="form-group"><label for="dataset-url">URL</label> <input ng-model="addedDataset.url" id="dataset-url" type="url"><p>Make sure that you host the file on a server that has <code>Access-Control-Allow-Origin: *</code> set.</p></div><button type="submit" ng-click="addFromUrl(addedDataset)">Add dataset</button></form></div>'),t.put("dataset/datasetselector.html",'<div><div class="open-dataset-popup"></div><select id="dataset-select" ng-model="Dataset.dataset" ng-change="datasetChanged()" ng-options="dataset.name group by dataset.group for dataset in Dataset.datasets track by dataset.id"><option value="">Add dataset...</option></select><div class="drop-container"><div class="popup-menu popup-new-dataset"><div class="right"><a class="fa fa-close" ng-click="doneAdd()"></a></div><div class="hflex"><add-url-dataset></add-url-dataset><add-myria-dataset></add-myria-dataset><paste-dataset></paste-dataset></div></div></div></div>'),t.put("dataset/pastedataset.html",'<div class="paste-data"><h3>Paste raw data</h3><p>Paste data in <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> format. Please include a header with field names.</p><form><div class="form-group"><label for="dataset-name">Name</label> <input ng-model="datasetName" id="dataset-name" type="name"></div><div class="form-group"><textarea ng-model="data"></textarea></div><button type="submit" ng-click="addPasted()">Add data</button></form></div>'),t.put("fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCountCaret || field.aggregate!==\'count\'}"><i class="fa fa-caret-down" ng-show="showCaret"></i> <span class="type icon-small icon-type-{{typeNames[field.type]}}" ng-show="showType" title="{{typeNames[field.type]}}">{{field.type}}</span></span> <span ng-if="field.aggregate!==\'count\'" class="field-info-text"><span ng-if="func(field)" class="field-func" ng-class="{any: field._any}">{{ func(field) }}</span><span class="field-name" ng-class="{hasfunc: func(field), any: field._any}">{{ field.name | underscore2space }}</span></span> <span ng-if="field.aggregate===\'count\'" class="field-count field-info-text"><span class="field-name">COUNT</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span> <span class="no-shrink info" ng-show="showInfo"><i ng-if="field.aggregate !== \'count\' && isTypes(field, [\'N\', \'O\'])" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min}}<br> <strong>Max:</strong> {{stats.max}}<br> <strong>Max length:</strong> {{stats.maxlength | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggregate !== \'count\' && field.type === \'T\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | date: short}}<br> <strong>Max:</strong> {{stats.max | date: short}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i> <i ng-if="field.aggregate !== \'count\' && field.type === \'Q\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Name:</strong> {{field.name}}<br> <strong>Cardinality:</strong> {{stats.distinct | number}}<br> <strong>Min:</strong> {{stats.min | number}}<br> <strong>Max:</strong> {{stats.max | number}}<br> <strong>Stdev:</strong> {{stats.stdev | number:2}}<br> <strong>Mean:</strong> {{stats.mean | number:2}}<br> <strong>Median:</strong> {{stats.median | number}}<br> <strong>Sample:</strong> <span class=\'sample\'>{{stats.sample.join(\', \')}}</span> </div>" tooltip-side="right"></i><i ng-if="field.aggregate === \'count\'" class="fa fa-info-circle" tooltips="" tooltip-size="small" tooltip-html="<div class=\'tooltip-content\'> <strong>Count:</strong> {{stats.max}} </div>" tooltip-side="right"></i></span></span></span>'),t.put("vlplot/vlplot.html",'<div class="vis" id="vis-{{visId}}" ng-class="{ fit: !alwaysScrollable && !overflow && (maxHeight && (!height || height <= maxHeight)) && (maxWidth && (!width || width <= maxWidth)), overflow: alwaysScrollable || overflow || (maxHeight && height && height > maxHeight) || (maxWidth && width && width > maxWidth), scroll: alwaysScrollable || unlocked || hoverFocus }" ng-mousedown="unlocked=!thumbnail" ng-mouseup="unlocked=false" ng-mouseover="mouseover()" ng-mouseout="mouseout()"><div class="vis-tooltip" ng-show="tooltipActive"><table><tr ng-repeat="p in data"><td class="key">{{p[0]}}</td><td class="value"><b ng-if="p.isNumber">{{p[1]| number: 2}}</b> <b ng-if="!p.isNumber">{{p[1]}}</b></td></tr></table></div></div>'),t.put("vlplotgroup/vlplotgroup.html",'<div class="vl-plot-group card vflex"><div ng-show="showExpand || fieldSet || showBookmark || showToggle" class="vl-plot-group-header full-width no-shrink"><div class="field-set-info"><field-info ng-repeat="field in fieldSet" ng-if="fieldSet" field="field" show-type="true" ng-class="{ selected: alwaysSelected || (isSelected && isSelected(field.name)), unselected: isSelected && !isSelected(field.name), highlighted: (highlighted||{})[field.name] }" ng-mouseover="(highlighted||{})[field.name] = true" ng-mouseout="(highlighted||{})[field.name] = false"></field-info></div><div class="toolbox"><a ng-show="consts.debug && showDebug" class="command debug"><i class="fa fa-wrench" ng-click="shCopied=\'\'; vlCopied=\'\'; vgCopied=\'\';"></i></a><div class="drop-container"><div class="popup-menu popup-command no-shrink dev-tool"><div class="command debug"><span class="debug">Vls</span> <a class="debug" ui-zeroclip="" zeroclip-copied="shCopied=\'(Coplied)\'" zeroclip-model="chart.shorthand">Copy</a> / <a class="debug" ng-click="logCode(\'VL shorthand\', chart.shorthand); shCopied=\'(Logged)\';">Log</a> <span>{{shCopied}}</span></div><div class="command debug"><span class="debug">Vl</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vlCopied=\'(Coplied)\'" zeroclip-model="chart.cleanSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega-lite\', chart.cleanSpec); vlCopied=\'(Logged)\';">Log</a> <span>{{vlCopied}}</span></div><div class="command debug"><span class="debug">Vg</span> <a class="debug" ui-zeroclip="" zeroclip-copied="vgCopied=\'(Coplied)\'" zeroclip-model="chart.vgSpec | compactJSON">Copy</a> / <a class="debug" ng-click="logCode(\'Vega\', chart.vgSpec); vgCopied=\'(Logged)\';">Log</a> <span>{{vgCopied}}</span></div><a class="command debug" ng-href="{{ {type:\'vl\', encoding: chart.cleanSpec} | reportUrl }}" target="_blank">Report Bad Render</a> <a ng-click="showFeature=!showFeature" class="command debug">{{chart.score}}</a><div ng-repeat="f in chart.scoreFeatures track by f.reason">[{{f.score}}] {{f.reason}}</div></div></div><a ng-if="showMarkType" class="command disabled"><i class="fa fa-font"></i> <i class="fa fa-line-chart"></i> <i class="fa fa-area-chart"></i> <i class="fa fa-bar-chart"></i> <i class="fa fa-circle-o"></i></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'x\')" class="command" ng-click="log.toggle(chart.vlSpec, \'x\')" ng-class="{active: log.active(chart.vlSpec, \'x\')}"><i class="fa fa-long-arrow-right"></i> <small>LOG X</small></a> <a ng-if="showLog && chart.vlSpec && log.support(chart.vlSpec, \'y\')" class="command" ng-click="log.toggle(chart.vlSpec, \'y\')" ng-class="{active: log.active(chart.vlSpec, \'y\')}"><i class="fa fa-long-arrow-up"></i> <small>LOG Y</small></a> <a ng-show="showSort && chart.vlSpec && toggleSort.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleSort(chart.vlSpec)"><i class="fa sort" ng-class="toggleSortClass(chart.vlSpec)"></i> <small ng-if="showLabel">Sort</small></a> <a ng-if="showFilterNull && chart.vlSpec && toggleFilterNull.support(chart.vlSpec, Dataset.stats)" class="command" ng-click="toggleFilterNull(chart.vlSpec)" ng-class="{active: chart.vlSpec && chart.vlSpec.cfg.filterNull.O}"><i class="fa fa-filter"></i> <small ng-if="showLabel">Filter</small> <small>NULL</small></a> <a ng-if="showTranspose" class="command" ng-click="transpose()"><i class="fa fa-refresh transpose"></i> <small ng-if="showLabel">Transpose</small></a> <a ng-if="showBookmark" class="command" ng-click="Bookmarks.toggle(chart)" ng-class="{disabled: !chart.vlSpec.encoding, active: Bookmarks.isBookmarked(chart.shorthand)}"><i class="fa fa-bookmark"></i> <small ng-if="showLabel">Bookmark</small></a> <a ng-if="showExpand" ng-click="expandAction()" class="command"><i class="fa fa-expand"></i></a></div></div><div class="vl-plot-wrapper full-width vis-{{fieldSet.key}} flex-grow-1"><vl-plot chart="chart" disabled="disabled" is-in-list="isInList" always-scrollable="alwaysScrollable" config-set="{{configSet||\'small\'}}" max-height="maxHeight" max-width="maxWidth" overflow="overflow" priority="priority" rescale="rescale" thumbnail="thumbnail" tooltip="tooltip"></vl-plot></div></div>')}])}(),function(){"use strict";angular.module("vlui").service("Alerts",function(t,e){var a={};return a.alerts=[],a.add=function(n,o){var i={msg:n};a.alerts.push(i),o&&t(function(){var t=e.findIndex(a.alerts,i);a.closeAlert(t)},o)},a.closeAlert=function(t){a.alerts.splice(t,1)},a})}(),function(){"use strict";angular.module("vlui").directive("bookmarkList",function(t,e){return{templateUrl:"bookmarklist/bookmarklist.html",restrict:"E",replace:!0,scope:{active:"=",deactivate:"&",highlighted:"="},link:function(a,n,o){a.Bookmarks=t,a.consts=e}}})}(),function(){"use strict";angular.module("vlui").service("Bookmarks",function(t,e,a,n){var o=function(){this.dict={},this.length=0},i=o.prototype;return i.updateLength=function(){this.length=Object.keys(this.dict).length},i.save=function(){a.set("bookmarks",this.dict)},i.load=function(){this.dict=a.get("bookmarks")||{},this.updateLength()},i.clear=function(){this.dict={},this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARKS_CLEAR)},i.toggle=function(t){var e=t.shorthand;this.dict[e]?this.remove(t):this.add(t)},i.add=function(e){var a=e.shorthand;console.log("adding",e.vlSpec,a),e.timeAdded=(new Date).getTime(),this.dict[a]=t.cloneDeep(e),this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARK_ADD,a)},i.remove=function(t){var e=t.shorthand;console.log("removing",t.vlSpec,e),delete this.dict[e],this.updateLength(),this.save(),n.logInteraction(n.actions.BOOKMARK_REMOVE,e)},i.isBookmarked=function(t){return t in this.dict},new o})}(),function(){"use strict";angular.module("vlui").factory("Config",function(t,e){var a={};return a.schema=t.schema.schema.properties.config,a.dataschema=t.schema.schema.properties.data,a.data=t.schema.util.instantiate(a.dataschema),a.config=t.schema.util.instantiate(a.schema),a.getConfig=function(){return e.cloneDeep(a.config)},a.getData=function(){return e.cloneDeep(a.data)},a.large=function(){return{singleWidth:400,singleHeight:400,largeBandMaxCardinality:20}},a.small=function(){return{}},a.updateDataset=function(t,e){t.values?(a.data.values=t.values,delete a.data.url,a.data.formatType=void 0):(a.data.url=t.url,delete a.data.values,a.data.formatType=e)},a})}(),function(){"use strict";angular.module("vlui").directive("addMyriaDataset",function(t,e,a){return{templateUrl:"dataset/addmyriadataset.html",restrict:"E",replace:!0,scope:!1,link:function(n){n.myriaRestUrl=a.myriaRest,n.myriaDatasets=[],n.myriaDataset=null,n.loadDatasets=function(e){return t.get(n.myriaRestUrl+"/dataset/search/?q="+e).then(function(t){n.myriaDatasets=t.data})},n.addFromMyria=function(t){var a={group:"myria",name:t.relationName,url:n.myriaRestUrl+"/dataset/user-"+t.userName+"/program-"+t.programName+"/relation-"+t.relationName+"/data?format=json"};e.type="json",e.dataset=e.add(angular.copy(a)),n.datasetChanged(),n.myriaDataset=null,n.doneAdd()}}}})}(),function(){"use strict";angular.module("vlui").directive("addUrlDataset",function(t){return{templateUrl:"dataset/addurldataset.html",restrict:"E",replace:!0,scope:!1,link:function(e){e.addedDataset={group:"user"},e.addFromUrl=function(a){t.dataset=t.add(angular.copy(a)),e.datasetChanged(),e.addedDataset.name="",e.addedDataset.url="",e.doneAdd()}}}})}(),function(){"use strict";function t(t){return t.reduce(function(t,e){return t[e.name]=e,t},{})}var e=[{name:"Barley",url:"data/barley.json",id:"barley",group:"sample"},{name:"Cars",url:"data/cars.json",id:"cars",group:"sample"},{name:"Crimea",url:"data/crimea.json",id:"crimea",group:"sample"},{name:"Driving",url:"data/driving.json",id:"driving",group:"sample"},{name:"Iris",url:"data/iris.json",id:"iris",group:"sample"},{name:"Jobs",url:"data/jobs.json",id:"jobs",group:"sample"},{name:"Population",url:"data/population.json",id:"population",group:"sample"},{name:"Movies",url:"data/movies.json",id:"movies",group:"sample"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes",group:"sample"},{name:"Burtin",url:"data/burtin.json",id:"burtin",group:"sample"},{name:"Budget 2016",url:"data/budget.json",id:"budget",group:"sample"},{name:"Climate Normals",url:"data/climate.json",id:"climate",group:"sample"},{name:"Campaigns",url:"data/weball26.json",id:"weball26",group:"sample"}];angular.module("vlui").factory("Dataset",function(a,n,o,i,r,s,l){var c={};c.datasets=e,c.dataset=e[1],c.currentDataset=void 0,c.dataschema=[],c.dataschema.byName={},c.stats={},c.type=void 0,c.typeNames={N:"text",O:"text-ordinal",Q:"number",T:"time",G:"geo"};var d={N:0,O:0,G:2,T:3,Q:4};return c.fieldOrderBy={},c.fieldOrderBy.type=function(t){return"count"===t.aggregate?4:d[t.type]},c.fieldOrderBy.typeThenName=function(t){return c.fieldOrderBy.type(t)+"_"+("count"===t.aggregate?"~":t.name.toLowerCase())},c.fieldOrderBy.original=function(){return 0},c.fieldOrderBy.name=function(t){return t.name},c.fieldOrderBy.cardinality=function(t,e){return e[t.name].distinct},c.fieldOrder=c.fieldOrderBy.typeThenName,c.getSchema=function(t,e,a){var n=s.type.inferAll(t),o=i.reduce(n,function(t,a,n){var o={name:n,type:l.data.types[a],primitiveType:a};return"Q"===o.type&&e[o.name].distinct<=5&&(o.type="O"),t.push(o),t},[]);return o=s.stablesort(o,a||c.fieldOrderBy.typeThenName,c.fieldOrderBy.name),o.push(l.field.count()),o},c.onUpdate=[],c.update=function(t){var e;return e=t.values?n(function(e,a){c.type=void 0,c.updateFromData(t,t.values),e()}):a.get(t.url,{cache:!0}).then(function(e){var a;if(i.isObject(e.data))a=e.data,c.type="json";else{var n=r.parse(e.data,{dynamicTyping:!0,header:!0});if(0!==n.errors.length)return void i.each(n.errors,function(t){o.add(t.message,2e3)});a=n.data,c.type="csv"}c.updateFromData(t,a)}),c.onUpdate.forEach(function(t){e=e.then(t)}),e},c.updateFromData=function(e,a){c.data=a,c.currentDataset=e,c.stats=l.data.stats(c.data),c.dataschema=c.getSchema(c.data,c.stats),c.dataschema.byName=t(c.dataschema)},c.add=function(t){return t.id||(t.id=t.url),e.push(t),t},c})}(),function(){"use strict";angular.module("vlui").directive("datasetSelector",function(t,e,a,n){return{templateUrl:"dataset/datasetselector.html",restrict:"E",replace:!0,scope:{},link:function(o,i){o.Dataset=e,o.datasetChanged=function(){return e.dataset?(n.logInteraction(n.actions.DATASET_CHANGE,e.dataset.name),void e.update(e.dataset).then(function(){a.updateDataset(e.dataset,e.type)})):(e.dataset=e.currentDataset,void r.open())},o.doneAdd=function(){r.close()};var r=new t({content:i.find(".popup-new-dataset")[0],target:i.find(".open-dataset-popup")[0],position:"right top",openOn:!1});o.$on("$destroy",function(){r.destroy(),r=null})}}})}(),function(){"use strict";angular.module("vlui").directive("pasteDataset",function(t,e,a,n,o,i){return{templateUrl:"dataset/pastedataset.html",restrict:"E",replace:!0,scope:!1,link:function(a){a.datasetName="",a.data="",a.addPasted=function(){var n,r=i.parse(a.data,{dynamicTyping:!0,header:!0});if(0!==r.errors.length)return void o.each(r.errors,function(t){e.add(t.message,2e3)});n=r.data;var s={id:Date.now(),name:a.datasetName,values:n,group:"pasted"};t.dataset=t.add(angular.copy(s)),a.datasetChanged(),a.datasetName="",a.data="",a.doneAdd()}}}})}(),function(){"use strict";angular.module("vlui").directive("fieldInfo",function(t,e,a){return{templateUrl:"fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{field:"=",showType:"=",showInfo:"=",showCaret:"=",popupContent:"=",showRemove:"=",removeAction:"&",action:"&",disableCountCaret:"="},link:function(n,o){var i;n.typeNames=t.typeNames,n.stats=t.stats[n.field.name],n.isTypes=a.field.isTypes,n.clicked=function(t){n.action&&t.target!==o.find(".fa-caret-down")[0]&&t.target!==o.find("span.type")[0]&&n.action(t)},n.func=function(t){return t.aggregate||t.timeUnit||t.bin&&"bin"||t._aggr||t._timeUnit||t._bin&&"bin"||t._any&&"auto"},n.$watch("popupContent",function(t){t&&(i&&i.destroy(),i=new e({content:t,target:o.find(".type-caret")[0],position:"bottom left",openOn:"click"}))}),n.$on("$destroy",function(){i&&i.destroy()})}}})}(),function(){"use strict";angular.module("vlui").service("Logger",function(t,e,a,n,o,i,r){var s={},l=t.search().user;return s.db=a.openDatabase("logs","1.0","Logs",2097152),s.tableName="log_"+n.appId,s.actions={INITIALIZE:"INITIALIZE",UNDO:"UNDO",REDO:"REDO",DATASET_CHANGE:"DATASET_CHANGE",CHART_MOUSEOVER:"CHART_MOUSEOVER",CHART_MOUSEOUT:"CHART_MOUSEOUT",CHART_RENDER:"CHART_RENDER",CHART_EXPOSE:"CHART_EXPOSE",CHART_TOOLTIP:"CHART_TOOLTIP",CHART_TOOLTIP_END:"CHART_TOOLTIP_END",BOOKMARK_ADD:"BOOKMARK_ADD",BOOKMARK_REMOVE:"BOOKMARK_REMOVE",BOOKMARKS_CLEAR:"BOOKMARKS_CLEAR",NULL_FILTER_TOGGLE:"NULL_FILTER_TOGGLE",TRANSPOSE_TOGGLE:"TRANSPOSE_TOGGLE",SORT_TOGGLE:"SORT_TOGGLE",MARKTYPE_TOGGLE:"MARKTYPE_TOGGLE",LOG_TOGGLE:"LOG_TOGGLE",FUNC_CHANGE:"FUNC_CHANGE",SPEC_CHANGE:"SPEC_CHANGE",FIELD_DROP:"FIELD_DROP",MARK_CHANGE:"MARK_CHANGE",FIELDS_CHANGE:"FIELDS_CHANGE",FIELDS_RESET:"FIELDS_RESET",DRILL_DOWN_OPEN:"DRILL_DOWN_OPEN",DRILL_DOWN_CLOSE:"DRILL_DOWN_CLOSE",CLUSTER_SELECT:"CLUSTER_SELECT",LOAD_MORE:"LOAD_MORE"},s.createTableIfNotExists=function(){s.db.createTable(s.tableName,{userid:{type:"INTEGER","null":"NOT NULL"},time:{type:"TIMESTAMP","null":"NOT NULL","default":"CURRENT_TIMESTAMP"},action:{type:"TEXT","null":"NOT NULL"},data:{type:"TEXT"},diff:{type:"TEXT"}})},s.clear=function(){var t=e.confirm("Really clear the logs?");t===!0&&(s.db.dropTable(s.tableName),s.createTableIfNotExists())},s["export"]=function(){s.db.selectAll(s.tableName).then(function(t){if(0===t.rows.length)return void console.warn("No logs");for(var e=[],a=0;a<t.rows.length;a++)e.push(t.rows.item(a));var n=o.unparse(e),l=new i([n],{type:"text/csv"}),c=r.createObjectURL(l),d=angular.element("<a/>");d.attr({href:c,target:"_blank",download:s.tableName+".csv"})[0].click()})},s.logInteraction=function(t,e,a){if(n.logging){var o={userid:l,action:t};void 0!==e&&(o.data=JSON.stringify(e)),void 0!==a&&(o.diff=JSON.stringify(a)),s.db.insert(s.tableName,o).then(function(){})}},s.createTableIfNotExists(),console.log("app:",n.appId,"started"),s.logInteraction(s.actions.INITIALIZE,n.appId),s})}(),function(){(function(){function t(e,n){function i(t){if(i[t]!==m)return i[t];var e;if("bug-string-char-index"==t)e="a"!="a"[0];else if("json"==t)e=i("json-stringify")&&i("json-parse");else{var a,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var l=n.stringify,d="function"==typeof l&&b;if(d){(a=function(){return 1}).toJSON=a;try{d="0"===l(0)&&"0"===l(new r)&&'""'==l(new s)&&l(y)===m&&l(m)===m&&l()===m&&"1"===l(a)&&"[1]"==l([a])&&"[null]"==l([m])&&"null"==l(null)&&"[null,null,null]"==l([m,y,null])&&l({a:[a,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===l(null,a)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new c(-1))}catch(u){d=!1}}e=d}if("json-parse"==t){var p=n.parse;if("function"==typeof p)try{if(0===p("0")&&!p(!1)){a=p(o);var f=5==a.a.length&&1===a.a[0];if(f){try{f=!p('"	"')}catch(u){}if(f)try{f=1!==p("01")}catch(u){}if(f)try{f=1!==p("1.")}catch(u){}}}}catch(u){f=!1}e=f}}return i[t]=!!e}e||(e=o.Object()),n||(n=o.Object());var r=e.Number||o.Number,s=e.String||o.String,l=e.Object||o.Object,c=e.Date||o.Date,d=e.SyntaxError||o.SyntaxError,u=e.TypeError||o.TypeError,p=e.Math||o.Math,f=e.JSON||o.JSON;"object"==typeof f&&f&&(n.stringify=f.stringify,n.parse=f.parse);var g,h,m,v=l.prototype,y=v.toString,b=new c(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(w){}var S="[object Function]",O="[object Date]",T="[object Number]",E="[object String]",C="[object Array]",N="[object Boolean]",k=i("bug-string-char-index");if(!b)var A=p.floor,_=[0,31,59,90,120,151,181,212,243,273,304,334],L=function(t,e){return _[e]+365*(t-1970)+A((t-1969+(e=+(e>1)))/4)-A((t-1901+e)/100)+A((t-1601+e)/400)};(g=v.hasOwnProperty)||(g=function(t){var e,a={};return(a.__proto__=null,a.__proto__={toString:1},a).toString!=y?g=function(t){var e=this.__proto__,a=t in(this.__proto__=null,this);return this.__proto__=e,a}:(e=a.constructor,g=function(t){var a=(this.constructor||e).prototype;return t in this&&!(t in a&&this[t]===a[t])}),a=null,g.call(this,t)}),h=function(t,e){var n,o,i,r=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,o=new n;for(i in o)g.call(o,i)&&r++;return n=o=null,r?h=2==r?function(t,e){var a,n={},o=y.call(t)==S;for(a in t)o&&"prototype"==a||g.call(n,a)||!(n[a]=1)||!g.call(t,a)||e(a)}:function(t,e){var a,n,o=y.call(t)==S;for(a in t)o&&"prototype"==a||!g.call(t,a)||(n="constructor"===a)||e(a);(n||g.call(t,a="constructor"))&&e(a)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],h=function(t,e){var n,i,r=y.call(t)==S,s=!r&&"function"!=typeof t.constructor&&a[typeof t.hasOwnProperty]&&t.hasOwnProperty||g;for(n in t)r&&"prototype"==n||!s.call(t,n)||e(n);for(i=o.length;n=o[--i];s.call(t,n)&&e(n));}),h(t,e)};var R={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},D="000000",x=function(t,e){return(D+(e||0)).slice(-t)},I="\\u00",U=function(t){for(var e='"',a=0,n=t.length,o=!k||n>10,i=o&&(k?t.split(""):t);n>a;a++){var r=t.charCodeAt(a);switch(r){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=R[r];break;default:if(32>r){e+=I+x(2,r.toString(16));break}e+=o?i[a]:t.charAt(a)}}return e+'"'},M=function(t,e,a,n,o,i,r,s){var l,c,d,p,f,v,b,w,S,k,_,R,D,I,j,G;s=s||0;try{l=e[t]}catch(B){}if("object"==typeof l&&l)if(c=y.call(l),c!=O||g.call(l,"toJSON"))"function"==typeof l.toJSON&&(c!=T&&c!=E&&c!=C||g.call(l,"toJSON"))&&(l=l.toJSON(t));else if(l>-1/0&&1/0>l){if(L){for(f=A(l/864e5),d=A(f/365.2425)+1970-1;L(d+1,0)<=f;d++);for(p=A((f-L(d,0))/30.42);L(d,p+1)<=f;p++);f=1+f-L(d,p),v=(l%864e5+864e5)%864e5,b=A(v/36e5)%24,w=A(v/6e4)%60,S=A(v/1e3)%60,k=v%1e3}else d=l.getUTCFullYear(),p=l.getUTCMonth(),f=l.getUTCDate(),b=l.getUTCHours(),w=l.getUTCMinutes(),S=l.getUTCSeconds(),k=l.getUTCMilliseconds();l=(0>=d||d>=1e4?(0>d?"-":"+")+x(6,0>d?-d:d):x(4,d))+"-"+x(2,p+1)+"-"+x(2,f)+"T"+x(2,b)+":"+x(2,w)+":"+x(2,S)+"."+x(3,k)+"Z"}else l=null;if(a&&(l=a.call(e,t,l)),null===l)return"null";if(c=y.call(l),c==N)return""+l;if(c==T)return l>-1/0&&1/0>l?""+l:"null";if(c==E)return U(""+l);if("object"==typeof l){for(I=r.length;I--;)if(r[I]===l)throw u();if(r.push(l),_=[],j=i,i+=o,c==C){var G,H=i.length;for(D=0,I=l.length;I>D;D++)R=M(D,l,a,n,o,i,r,s),G=R===m?"null":R,H+=G.length+(D>0?1:0),_.push(G);G=_.length?o&&H>s?"[\n"+i+_.join(",\n"+i)+"\n"+j+"]":"["+_.join(",")+"]":"[]"}else{var H=i.length,D=0;h(n||l,function(t){var e,c=M(t,l,a,n,o,i,r,s);c!==m&&(e=U(t)+":"+(o?" ":"")+c,H+=e.length+(D++>0?1:0),_.push(e))}),G=_.length?o&&H>s?"{\n"+i+_.join(",\n"+i)+"\n"+j+"}":"{"+_.join(",")+"}":"{}"}return r.pop(),G}};if(n.stringify=function(t,e,n,o){var i,r,s,l;if(a[typeof e]&&e)if((l=y.call(e))==S)r=e;else if(l==C){s={};for(var c,d=0,u=e.length;u>d;c=e[d++],l=y.call(c),(l==E||l==T)&&(s[c]=1));}if(n)if((l=y.call(n))==T){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else l==E&&(i=n.length<=10?n:n.slice(0,10));return M("",(c={},c[""]=t,c),r,s,i,"",[],o)},n.compactStringify=function(t,e,a){return n.stringify(t,e,a,60)},!i("json-parse")){var j,G,B=s.fromCharCode,H={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw j=G=null,d()},F=function(){for(var t,e,a,n,o,i=G,r=i.length;r>j;)switch(o=i.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=k?i.charAt(j):i[j],j++,t;case 34:for(t="@",j++;r>j;)if(o=i.charCodeAt(j),32>o)P();else if(92==o)switch(o=i.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=H[o],j++;break;case 117:for(e=++j,a=j+4;a>j;j++)o=i.charCodeAt(j),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||P();t+=B("0x"+i.slice(e,j));break;default:P()}else{if(34==o)break;for(o=i.charCodeAt(j),e=j;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++j);t+=i.slice(e,j)}if(34==i.charCodeAt(j))return j++,t;P();default:if(e=j,45==o&&(n=!0,o=i.charCodeAt(++j)),o>=48&&57>=o){for(48==o&&(o=i.charCodeAt(j+1),o>=48&&57>=o)&&P(),n=!1;r>j&&(o=i.charCodeAt(j),o>=48&&57>=o);j++);if(46==i.charCodeAt(j)){for(a=++j;r>a&&(o=i.charCodeAt(a),o>=48&&57>=o);a++);a==j&&P(),j=a}if(o=i.charCodeAt(j),101==o||69==o){for(o=i.charCodeAt(++j),(43==o||45==o)&&j++,a=j;r>a&&(o=i.charCodeAt(a),o>=48&&57>=o);a++);a==j&&P(),j=a}return+i.slice(e,j)}if(n&&P(),"true"==i.slice(j,j+4))return j+=4,!0;if("false"==i.slice(j,j+5))return j+=5,!1;if("null"==i.slice(j,j+4))return j+=4,null;P()}return"$"},K=function(t){var e,a;if("$"==t&&P(),"string"==typeof t){if("@"==(k?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=F(),"]"!=t;a||(a=!0))a&&(","==t?(t=F(),"]"==t&&P()):P()),","==t&&P(),e.push(K(t));return e}if("{"==t){for(e={};t=F(),"}"!=t;a||(a=!0))a&&(","==t?(t=F(),"}"==t&&P()):P()),(","==t||"string"!=typeof t||"@"!=(k?t.charAt(0):t[0])||":"!=F())&&P(),e[t.slice(1)]=K(F());return e}P()}return t},J=function(t,e,a){var n=z(t,e,a);n===m?delete t[e]:t[e]=n},z=function(t,e,a){var n,o=t[e];if("object"==typeof o&&o)if(y.call(o)==C)for(n=o.length;n--;)J(o,n,a);else h(o,function(t){J(o,t,a)});return a.call(t,e,o)};n.parse=function(t,e){var a,n;return j=0,G=""+t,a=K(F()),"$"!=F()&&P(),j=G=null,e&&y.call(e)==S?z((n={},n[""]=a,n),"",e):a}}return n.runInContext=t,n}var e="function"==typeof define&&define.amd,a={"function":!0,object:!0},n=a[typeof exports]&&exports&&!exports.nodeType&&exports,o=a[typeof window]&&window||this,i=n&&a[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!i||i.global!==i&&i.window!==i&&i.self!==i||(o=i),n&&!e)t(o,n);else{var r=o.JSON,s=o.JSON3,l=!1,c=t(o,o.JSON3={noConflict:function(){return l||(l=!0,o.JSON=r,o.JSON3=s,r=s=null),c}});o.JSON={parse:c.parse,stringify:c.stringify}}e&&define(function(){return c})}).call(this)}(),function(){"use strict";angular.module("vlui").directive("vlPlot",function(t,e,a,n,o,i,r,s,l,c,d){function u(t,e){return t>f||e>f||t*e>g?"svg":"canvas"}var p=0,f=16383.5,g=67108864,h=new d(function(t,e){return e.priority-t.priority}),m=!1;return{templateUrl:"vlplot/vlplot.html",restrict:"E",scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"="},replace:!0,link:function(n,d){function f(t,o){o.datum.data&&(n.tooltipPromise=a(function(){n.tooltipActive=!0,c.logInteraction(c.actions.CHART_TOOLTIP,o.datum),n.data=s.pairs(o.datum.data).map(function(t){return t.isNumber=e.isNumber(t[1]),t}),n.$digest();var a=d.find(".vis-tooltip"),i=angular.element(l),r=a.width(),u=a.height();t.pageY+10+u<i.height()?a.css("top",t.pageY+10):a.css("top",t.pageY-10-u),t.pageX+10+r<i.width()?a.css("left",t.pageX+10):a.css("left",t.pageX-10-r)},O))}function g(t,e){var o=d.find(".vis-tooltip");o.css("top",null),o.css("left",null),a.cancel(n.tooltipPromise),n.tooltipActive&&c.logInteraction(c.actions.CHART_TOOLTIP_END,e.datum),n.tooltipActive=!1,n.data=[],n.$digest()}function v(){var e=n.configSet||r.defaultConfigSet||{};if(n.chart.vlSpec){var a=s.cloneDeep(n.chart.vlSpec);return t.extend(a.config,i[e]()),t.compile(a,o.stats)}}function y(){if(n.rescale){for(var t=n.maxWidth>0?n.maxWidth/n.width:1,e=n.maxHeight>0?n.maxHeight/n.height:1,a=Math.min(t,e),o=1;.75*o>a;)o/=2;var i=100*o/2&&0;d.find(".vega").css("transform","translate(-"+i+"%, -"+i+"%) scale("+o+")")}else d.find(".vega").css("transform",null)}function b(){
if(h.size()>0){var t=h.pop();t.parse()}else m=!1}function w(a){function i(){if(n.destroyed||n.disabled||n.isInList&&n.chart.fieldSetKey&&!n.isInList(n.chart.fieldSetKey))return console.log("cancel rendering",s),void b();var t=(new Date).getTime();e.parse.spec(a,function(e){try{var i=(new Date).getTime();T=null,T=e({el:d[0]}),r.useUrl||T.data({raw:o.data}),n.width=T.width(),n.height=T.height(),T.renderer(u(a.width,n.height)),T.update(),c.logInteraction(c.actions.CHART_RENDER,n.chart.vlSpec),y();var l=(new Date).getTime();console.log("parse spec",i-t,"charting",l-i,s),n.tooltip&&(T.on("mouseover",f),T.on("mouseout",g))}catch(p){console.error(p)}finally{b()}})}if(!a)return void(T&&(T.off("mouseover"),T.off("mouseout")));n.height=a.height,d||console.error("can not find vis element");var s=n.chart.shorthand||(n.chart.vlSpec?t.Encoding.shorthand(n.chart.vlSpec):"");n.renderer=u(a),m?h.push({priority:n.priority||0,parse:i}):(m=!0,i())}var S=500,O=250;n.visId=p++,n.hoverPromise=null,n.tooltipPromise=null,n.hoverFocus=!1,n.tooltipActive=!1,n.destroyed=!1,n.mouseover=function(){n.hoverPromise=a(function(){c.logInteraction(c.actions.CHART_MOUSEOVER,n.chart.vlSpec),n.hoverFocus=!n.thumbnail},S)},n.mouseout=function(){n.hoverFocus&&c.logInteraction(c.actions.CHART_MOUSEOUT,n.chart.vlSpec),a.cancel(n.hoverPromise),n.hoverFocus=n.unlocked=!1};var T;n.$watch("chart.vlSpec",function(){var e=n.chart.vgSpec=v();n.chart.cleanSpec||(n.chart.cleanSpec=t.Encoding.fromSpec(n.chart.vlSpec).toSpec(!0)),w(e)},!0),n.$on("$destroy",function(){console.log("vlplot destroyed"),T&&(T.off("mouseover"),T.off("mouseout"),T=null),n.destroyed=!0})}}})}(),function(){"use strict";angular.module("vlui").directive("vlPlotGroup",function(t,e,a,n,o,i){return{templateUrl:"vlplotgroup/vlplotgroup.html",restrict:"E",replace:!0,scope:{chart:"=",disabled:"=",isInList:"=",alwaysScrollable:"=",configSet:"@",maxHeight:"=",maxWidth:"=",overflow:"=",priority:"=",rescale:"=",thumbnail:"=",tooltip:"=",fieldSet:"=",showBookmark:"@",showDebug:"=",showExpand:"=",showFilterNull:"@",showLabel:"@",showLog:"@",showMarkType:"@",showSort:"@",showTranspose:"@",alwaysSelected:"=",isSelected:"=",highlighted:"=",expandAction:"&"},link:function(r,s){r.Bookmarks=t,r.consts=e,r.Dataset=n,r.logCode=function(t,e){console.log(t+":\n\n",JSON.stringify(e))},r.log={},r.log.support=function(t,e){if(!t)return!1;var a=t.encoding,n=a[e];return n&&"Q"===n.type&&!n.bin},r.log.toggle=function(t,e){if(r.log.support(t,e)){var a=t.encoding[e],n=a.scale=a.scale||{};n.type="log"===n.type?"linear":"log",i.logInteraction(i.actions.LOG_TOGGLE,r.chart.shorthand)}},r.log.active=function(t,e){if(r.log.support(t,e)){var a=t.encoding[e],n=a.scale=a.scale||{};return"log"===n.type}};var l=r.toggleSort=function(t){i.logInteraction(i.actions.SORT_TOGGLE,r.chart.shorthand),a.Encoding.toggleSort(t)};l.support=a.Encoding.toggleSort.support,r.toggleFilterNull=function(t,e){i.logInteraction(i.actions.NULL_FILTER_TOGGLE,r.chart.shorthand),a.Encoding.toggleFilterNullO(t,e)},r.toggleFilterNull.support=a.Encoding.toggleFilterNullO.support;var c=new o({content:s.find(".dev-tool")[0],target:s.find(".fa-wrench")[0],position:"bottom right",openOn:"click",constrainToWindow:!0});r.toggleSortClass=function(t){var e=t&&a.Encoding.toggleSort.direction(t),n=t&&a.Encoding.toggleSort.mode(t);return"y"===e?"Q"===n?"fa-sort-amount-desc":"fa-sort-alpha-asc":"x"===e?"Q"===n?"fa-sort-amount-desc sort-x":"fa-sort-alpha-asc sort-x":"invisible"},r.transpose=function(){i.logInteraction(i.actions.TRANSPOSE_TOGGLE,r.chart.shorthand),a.Encoding.transpose(r.chart.vlSpec)},r.$on("$destroy",function(){r.chart=null,c.destroy()})}}})}(),function(){"use strict";angular.module("vlui").filter("compactJSON",function(){return function(t){return JSON.stringify(t,null,"  ",80)}})}(),function(){"use strict";angular.module("vlui").filter("encodeURI",function(){return function(t){return window.encodeURI(t)}})}(),function(){"use strict";angular.module("vlui").filter("reportUrl",function(t,e,a){function n(a){var n="https://docs.google.com/forms/d/1T9ZA14F3mmzrHR7JJVUKyPXzrMqF54CjLIOjv2E7ZEM/viewform?";if(a.fields){var o=encodeURI(t(e.values(a.fields)));n+="entry.1245199477="+o+"&"}if(a.encoding){var i=e.omit(a.encoding,"config");i=encodeURI(t(i)),n+="entry.1323680136="+i+"&"}if(a.encoding2){var r=e.omit(a.encoding2,"config");r=encodeURI(t(r)),n+="entry.853137786="+r+"&"}var s="entry.1940292677=";switch(a.type){case"vl":n+=s+"Visualization+Rendering+(Vegalite)&";break;case"vr":n+=s+"Recommender+Algorithm+(Visrec)&";break;case"fv":n+=s+"Recommender+UI+(FacetedViz)&"}return n}function o(a){var n="https://docs.google.com/forms/d/1xKs-qGaLZEUfbTmhdmSoS13OKOEpuu_NNWE5TAAml_Y/viewform?";if(a.encoding){var o=e.omit(a.encoding,"config");o=encodeURI(t(o)),n+="entry.1245199477="+o+"&"}return n}return"voyager"===a.appId?n:o})}(),function(){"use strict";angular.module("vlui").filter("scaleType",function(){return function(t){var e={Q:"Quantitative",N:"Nominal",O:"Ordinal",T:"Time"};return e[t]}})}(),function(){"use strict";angular.module("vlui").filter("underscore2space",function(){return function(t){return t?t.replace(/_+/g," "):""}})}();