"use strict";function getNameMap(a){return a.reduce(function(a,t){return a[t.name]=t,a},{})}angular.module("vlui",[]).constant("_",window._).constant("vl",window.vl).constant("vg",window.vg).constant("Papa",window.Papa).constant("dl",window.dl),angular.module("vlui").service("Alerts",function(a,t){var e={};return e.alerts=[],e.add=function(n,r){var s={msg:n};e.alerts.push(s),r&&a(function(){var a=t.findIndex(e.alerts,s);e.closeAlert(a)},r)},e.closeAlert=function(a){e.alerts.splice(a,1)},e});var datasets=[{name:"Barley",url:"data/barley.json",id:"barley"},{name:"Cars",url:"data/cars.json",id:"cars"},{name:"Crimea",url:"data/crimea.json",id:"crimea"},{name:"Driving",url:"data/driving.json",id:"driving"},{name:"Iris",url:"data/iris.json",id:"iris"},{name:"Jobs",url:"data/jobs.json",id:"jobs"},{name:"Population",url:"data/population.json",id:"population"},{name:"Movies",url:"data/movies.json",id:"movies"},{name:"Birdstrikes",url:"data/birdstrikes.json",id:"birdstrikes"},{name:"Burtin",url:"data/burtin.json",id:"burtin"},{name:"Budget 2016",url:"data/budget.json",id:"budget"},{name:"Climate Normals",url:"data/climate.json",id:"climate"},{name:"Campaigns",url:"data/weball26.json",id:"weball26"}];angular.module("vlui").factory("Dataset",function(a,t,e,n,r,s){var d={};return d.datasets=datasets,d.dataset=datasets[1],d.dataschema=[],d.dataschema.byName={},d.stats={},d.type=void 0,d.typeNames={O:"text",Q:"number",T:"time",G:"geo"},d.fieldOrder=s.field.order.typeThenName,d.getSchema=function(a,t,n){var d=r.read.types(a),i=e.reduce(d,function(a,t,e){return a.push({name:e,type:s.data.types[t]}),a},[]);return i=r.stablesort(i,n||s.field.order.typeThenName,s.field.order.name),i.push(s.field.count()),i.forEach(function(a){var e=t[a.name];void 0!==e&&"Q"===a.type&&e.distinct<=20&&(e.distinct<(e.count-e.numNulls)/50||e.distinct<=7)&&(a.type="O")}),i},d.getStats=function(a){var t=r.summary(a);return t.reduce(function(a,t){return a[t.field]=t,a},{count:a.length})},d.update=function(r){return a.get(r.url,{cache:!0}).then(function(a){if(e.isObject(a.data))d.data=a.data,d.type="json";else{var r=n.parse(a.data,{dynamicTyping:!0,header:!0});if(0!==r.errors.length)return e.each(r.errors,function(a){t.add(a.message,2e3)}),void 0;d.data=r.data,d.type="csv"}d.stats=d.getStats(d.data),d.dataschema=d.getSchema(d.data,d.stats),d.dataschema.byName=getNameMap(d.dataschema)})},d.add=function(a){a.id||(a.id=a.url),datasets.push(a)},d});